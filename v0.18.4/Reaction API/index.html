<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Reaction API · PALEOboxes Documentation</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.044/juliamono.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">PALEOboxes Documentation</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Design</span><ul><li><a class="tocitem" href="../DesignOverview/">PALEOboxes coupler design</a></li><li><a class="tocitem" href="../CreateInitializeLoop/">Control flow</a></li></ul></li><li><span class="tocitem">Reference</span><ul><li><a class="tocitem" href="../DomainsVariablesFields/">Domains, Variables, Fields, and Data arrays.</a></li><li><a class="tocitem" href="../Solver API/">Solver API</a></li><li class="is-active"><a class="tocitem" href>Reaction API</a><ul class="internal"><li><a class="tocitem" href="#Reaction-struct"><span>Reaction struct</span></a></li><li><a class="tocitem" href="#Parameters"><span>Parameters</span></a></li><li><a class="tocitem" href="#Registering-with-PALEOboxes-framework"><span>Registering with PALEOboxes framework</span></a></li><li><a class="tocitem" href="#Optional-initialisation-callbacks-to-define-Domain-Grids-and-array-sizes"><span>Optional initialisation callbacks to define Domain Grids and array sizes</span></a></li><li><a class="tocitem" href="#Initialisation-callbacks"><span>Initialisation callbacks</span></a></li><li><a class="tocitem" href="#Predefined-ReactionMethods"><span>Predefined ReactionMethods</span></a></li><li><a class="tocitem" href="#Implementing-Reaction-method-functions"><span>Implementing Reaction method functions</span></a></li><li><a class="tocitem" href="#Internal-details-of-Variable-arrays-accessor-generation"><span>Internal details of Variable arrays accessor generation</span></a></li></ul></li><li><a class="tocitem" href="../ReactionCatalog/">Generic Reaction catalog</a></li></ul></li><li><a class="tocitem" href="../References/">References</a></li><li><a class="tocitem" href="../indexpage/">Index</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Reference</a></li><li class="is-active"><a href>Reaction API</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Reaction API</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/master/docs/src/Reaction API.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Reaction-API"><a class="docs-heading-anchor" href="#Reaction-API">Reaction API</a><a id="Reaction-API-1"></a><a class="docs-heading-anchor-permalink" href="#Reaction-API" title="Permalink"></a></h1><p>API calls used by <a href="#PALEOboxes.AbstractReaction"><code>AbstractReaction</code></a> implementations.</p><p>Implementations should create a subclass of <a href="#PALEOboxes.AbstractReaction"><code>AbstractReaction</code></a> containing a <a href="#PALEOboxes.ReactionBase"><code>ReactionBase</code></a> and <a href="#PALEOboxes.Parameter"><code>Parameter</code></a>s, register a reaction factory, and implement callbacks to define <a href="../DomainsVariablesFields/#PALEOboxes.VariableReaction"><code>VariableReaction</code></a>s and <a href="#PALEOboxes.ReactionMethod"><code>ReactionMethod</code></a>s.</p><h2 id="Reaction-struct"><a class="docs-heading-anchor" href="#Reaction-struct">Reaction struct</a><a id="Reaction-struct-1"></a><a class="docs-heading-anchor-permalink" href="#Reaction-struct" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.AbstractReaction" href="#PALEOboxes.AbstractReaction"><code>PALEOboxes.AbstractReaction</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">AbstractReaction</code></pre><p>Base Type for Reactions.</p><p><strong>Implementation</strong></p><p>Derived types should include a field <code>base::</code><a href="#PALEOboxes.ReactionBase"><code>ReactionBase</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/886b8583b4b3ac24b4091fe42fa3002d474d64ae/src/Types.jl#L41-L48">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.ReactionBase" href="#PALEOboxes.ReactionBase"><code>PALEOboxes.ReactionBase</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">ReactionBase</code></pre><p>Base Type for a biogeochemical Reaction.</p><p><strong>Implementation</strong></p><p>Include as field <code>base</code> in types derived from <a href="#PALEOboxes.AbstractReaction"><code>AbstractReaction</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/886b8583b4b3ac24b4091fe42fa3002d474d64ae/src/Reaction.jl#L3-L10">source</a></section></article><h2 id="Parameters"><a class="docs-heading-anchor" href="#Parameters">Parameters</a><a id="Parameters-1"></a><a class="docs-heading-anchor-permalink" href="#Parameters" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.AbstractParameter" href="#PALEOboxes.AbstractParameter"><code>PALEOboxes.AbstractParameter</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">AbstractParameter</code></pre><p>Base Type for Parameters</p><p>See also: <a href="#PALEOboxes.Parameter"><code>Parameter</code></a>, <a href="#PALEOboxes.VecParameter"><code>VecParameter</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/886b8583b4b3ac24b4091fe42fa3002d474d64ae/src/Types.jl#L16-L22">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.Parameter" href="#PALEOboxes.Parameter"><code>PALEOboxes.Parameter</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">Parameter{T, ParseFromString}</code></pre><p>A reaction parameter of type <code>T</code>. Create using short names <code>ParDouble</code>, <code>ParInt</code>, <code>ParBool</code>, <code>ParString</code>. Read value as <code>&lt;par&gt;.v::T</code>, set with <a href="#PALEOboxes.setvalue!"><code>setvalue!</code></a>.</p><p>Parameters with <code>external=true</code> may be set from the Model-level Parameters list, if <code>name</code> is present in that list.</p><p><code>ParseFromString</code> should usually be <code>Nothing</code>: a value of <code>Type T</code> is then required when calling <a href="#PALEOboxes.setvalue!"><code>setvalue!</code></a>. If <code>ParseFromString</code> is not <code>Nothing</code>, then <a href="#PALEOboxes.setvalue!"><code>setvalue!</code></a> will accept an <code>AbstractString</code> and call <code>Base.parse(ParseFromString, strvalue)</code>. This allows eg an enum-valued Parameter to be defined by Parameter{EnumType, EnumType} and implementing parse(EnumType, rawvalue::AbstractString)</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/886b8583b4b3ac24b4091fe42fa3002d474d64ae/src/Parameter.jl#L4-L17">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.VecParameter" href="#PALEOboxes.VecParameter"><code>PALEOboxes.VecParameter</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">VecParameter{T, ParseFromString}</code></pre><p>A reaction parameter of type Vector{T}. Create using short names <code>ParDoubleVec</code>, <code>ParStringVec</code>. Values are <code>&lt;par&gt;.v::Vector{T}</code>. Set using standard yaml syntax for a vector eg [1, 2, 3]</p><p><code>ParseFromString</code> should usually be <code>false</code> (see <a href="#PALEOboxes.Parameter"><code>Parameter</code></a>).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/886b8583b4b3ac24b4091fe42fa3002d474d64ae/src/Parameter.jl#L113-L122">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.VecVecParameter" href="#PALEOboxes.VecVecParameter"><code>PALEOboxes.VecVecParameter</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">VecVecParameter{T, ParseFromString}</code></pre><p>A reaction parameter of type Vector{Vector{T}}. Create using short names <code>ParDoubleVecVec</code>. Values are <code>&lt;par&gt;.v::Vector{Vector{T}}</code>. Set using standard yaml syntax for a vector of vectors eg [[1, 2, 3], [4, 5, 6]]</p><p><code>ParseFromString</code> should usually be <code>false</code> (see <a href="#PALEOboxes.Parameter"><code>Parameter</code></a>).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/886b8583b4b3ac24b4091fe42fa3002d474d64ae/src/Parameter.jl#L188-L197">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.ParametersTuple" href="#PALEOboxes.ParametersTuple"><code>PALEOboxes.ParametersTuple</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">ParametersTuple(parameters::AbstractParameter...) -&gt; NamedTuple
ParametersTuple(parameters) -&gt; NamedTuple</code></pre><p>Create a NamedTuple of Parameters.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/886b8583b4b3ac24b4091fe42fa3002d474d64ae/src/Parameter.jl#L443-L448">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.add_par" href="#PALEOboxes.add_par"><code>PALEOboxes.add_par</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">add_par(reaction::AbstractReaction, par::AbstractParameter)
add_par(reaction::AbstractReaction, objectwithpars)</code></pre><p>Add a single parameter or parameters from fields of <code>objectwithpars</code> to a new Reaction.</p><p>Not usually needed: Parameters in <code>pars::ParametersTuple</code><code>will be added automatically, only needed if there are additional Parameters that are not members of</code>pars`.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/886b8583b4b3ac24b4091fe42fa3002d474d64ae/src/Reaction.jl#L230-L238">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.setvalue!" href="#PALEOboxes.setvalue!"><code>PALEOboxes.setvalue!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">setvalue!(par::Parameter, value)</code></pre><p>Set Parameter to <code>value</code>.</p><p>Optionally (if <a href="#PALEOboxes.Parameter"><code>Parameter</code></a> has Type parameter <code>ParseFromString != Nothing</code>) parse <code>value</code> from a String.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/886b8583b4b3ac24b4091fe42fa3002d474d64ae/src/Parameter.jl#L299-L305">source</a></section></article><h2 id="Registering-with-PALEOboxes-framework"><a class="docs-heading-anchor" href="#Registering-with-PALEOboxes-framework">Registering with PALEOboxes framework</a><a id="Registering-with-PALEOboxes-framework-1"></a><a class="docs-heading-anchor-permalink" href="#Registering-with-PALEOboxes-framework" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.create_reaction-Tuple{Type{var&quot;#s6&quot;} where var&quot;#s6&quot;&lt;:PALEOboxes.AbstractReaction, PALEOboxes.ReactionBase}" href="#PALEOboxes.create_reaction-Tuple{Type{var&quot;#s6&quot;} where var&quot;#s6&quot;&lt;:PALEOboxes.AbstractReaction, PALEOboxes.ReactionBase}"><code>PALEOboxes.create_reaction</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">create_reaction(ReactionType::Type{&lt;:AbstractReaction}, base::ReactionBase) -&gt; reaction::AbstractReaction</code></pre><p>Create a <code>ReactionType</code> and set <code>base</code> field.</p><p>Default implementation may be overriden to eg set additional fields</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/886b8583b4b3ac24b4091fe42fa3002d474d64ae/src/ReactionFactory.jl#L54-L60">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.find_reaction" href="#PALEOboxes.find_reaction"><code>PALEOboxes.find_reaction</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">find_reaction(class::AbstractString) -&gt; ReactionType</code></pre><p>Look up &quot;class&quot; in list of Reactions from <a href="#PALEOboxes.find_all_reactions"><code>find_all_reactions</code></a>, and return  fully-qualified Reaction Type (including module prefixes).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/886b8583b4b3ac24b4091fe42fa3002d474d64ae/src/ReactionFactory.jl#L39-L44">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.find_all_reactions" href="#PALEOboxes.find_all_reactions"><code>PALEOboxes.find_all_reactions</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">find_all_reactions() -&gt; Dict{String, Type}</code></pre><p>Use <code>InteractiveUtils.subtypes(AbstractReaction)</code> to find all currently loaded subtypes off AbstractReaction, and create a <code>Dict</code> with last part of the name of the Type as key (ie without the module prefix) and Type as value.</p><p>Any Types that generate non-unique keys (eg Module1.MyReactionType and Module2.MyReactionType) will generate a warning, and no entry will be added to the Dict (so if this Reaction is present in a config file, it will not be found and will error).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/886b8583b4b3ac24b4091fe42fa3002d474d64ae/src/ReactionFactory.jl#L4-L14">source</a></section></article><h2 id="Optional-initialisation-callbacks-to-define-Domain-Grids-and-array-sizes"><a class="docs-heading-anchor" href="#Optional-initialisation-callbacks-to-define-Domain-Grids-and-array-sizes">Optional initialisation callbacks to define Domain Grids and array sizes</a><a id="Optional-initialisation-callbacks-to-define-Domain-Grids-and-array-sizes-1"></a><a class="docs-heading-anchor-permalink" href="#Optional-initialisation-callbacks-to-define-Domain-Grids-and-array-sizes" title="Permalink"></a></h2><p>One Reaction per domain may implement <a href="#PALEOboxes.set_model_geometry"><code>set_model_geometry</code></a> to create and attach a grid, and <a href="#PALEOboxes.set_data_dimension!"><code>set_data_dimension!</code></a>.</p><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.set_model_geometry" href="#PALEOboxes.set_model_geometry"><code>PALEOboxes.set_model_geometry</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">set_model_geometry(reaction, model)</code></pre><p>Optional: define model <code>Domain</code> size, Subdomains etc (only implemented by Reactions that define grids).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/886b8583b4b3ac24b4091fe42fa3002d474d64ae/src/Reaction.jl#L183-L188">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.set_data_dimension!" href="#PALEOboxes.set_data_dimension!"><code>PALEOboxes.set_data_dimension!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">set_data_dimension!(domain::Domain, dim::NamedDimension; allow_exists=false)</code></pre><p>Define a Domain data dimension.</p><p>Variable data dimensions are then defined as Tuples of <code>dim.name</code>s using the <code>:data_dims</code> Attribute.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/886b8583b4b3ac24b4091fe42fa3002d474d64ae/src/Domain.jl#L18-L24">source</a></section></article><h2 id="Initialisation-callbacks"><a class="docs-heading-anchor" href="#Initialisation-callbacks">Initialisation callbacks</a><a id="Initialisation-callbacks-1"></a><a class="docs-heading-anchor-permalink" href="#Initialisation-callbacks" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.register_methods!" href="#PALEOboxes.register_methods!"><code>PALEOboxes.register_methods!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">register_methods!(reaction)
register_methods!(reaction, model)</code></pre><p>Add <a href="#PALEOboxes.ReactionMethod"><code>ReactionMethod</code></a>s, using <a href="#PALEOboxes.add_method_setup!"><code>add_method_setup!</code></a>, <a href="#PALEOboxes.add_method_initialize!"><code>add_method_initialize!</code></a> <a href="#PALEOboxes.add_method_do!"><code>add_method_do!</code></a>. See also <a href="#PALEOboxes.register_dynamic_methods!"><code>register_dynamic_methods!</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/886b8583b4b3ac24b4091fe42fa3002d474d64ae/src/Reaction.jl#L201-L207">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.register_dynamic_methods!" href="#PALEOboxes.register_dynamic_methods!"><code>PALEOboxes.register_dynamic_methods!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">register_dynamic_methods!(reaction)
register_dynamic_methods!(reaction, model)</code></pre><p>Optional: called after first variable link pass, to add <a href="#PALEOboxes.ReactionMethod"><code>ReactionMethod</code></a>s that depend on Variables generated by other Reactions (see <a href="#PALEOboxes.register_methods!"><code>register_methods!</code></a>).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/886b8583b4b3ac24b4091fe42fa3002d474d64ae/src/Reaction.jl#L213-L220">source</a></section></article><h3 id="Defining-[VariableReaction](@ref)s"><a class="docs-heading-anchor" href="#Defining-[VariableReaction](@ref)s">Defining <a href="../DomainsVariablesFields/#PALEOboxes.VariableReaction"><code>VariableReaction</code></a>s</a><a id="Defining-[VariableReaction](@ref)s-1"></a><a class="docs-heading-anchor-permalink" href="#Defining-[VariableReaction](@ref)s" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.CreateVariableReaction" href="#PALEOboxes.CreateVariableReaction"><code>PALEOboxes.CreateVariableReaction</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">CreateVariableReaction(T, localname =&gt; link_namestr, units, description; attributes=Tuple()) -&gt; VariableReaction{T}
CreateVariableReaction(T, linklocal_namestr, units, description; attributes=Tuple()) -&gt; VariableReaction{T}    
[deprecated] CreateVariableReaction(T, localname, units, description; link_namestr, attributes=Tuple()) -&gt; VariableReaction{T}</code></pre><p>Create a <a href="../DomainsVariablesFields/#PALEOboxes.VariableReaction"><code>VariableReaction</code></a>.</p><p>Not called directly: use short names <code>VarProp</code>, <code>VarDep</code>, <code>VarContrib</code>, <code>VarTarget</code>,  <code>VarPropScalar</code>, <code>VarDepScalar</code>, <code>VarContribScalar</code>, <code>VarTargetScalar</code>.</p><p><strong>Arguments</strong></p><ul><li><code>var_type::VariableType</code>:  one of <code>VT_ReactProperty</code>, <code>VT_ReactDependency</code>, <code>VT_ReactContributor</code>, <code>VT_ReactTarget</code></li><li><code>localname::AbstractString</code>: Reaction-local Variable name</li><li><code>link_namestr::AbstractString</code>: <code>&lt;linkreq_domain&gt;.[linkreq_subdomain.]linkreq_name</code>. Parsed by <a href="#PALEOboxes.parse_variablereaction_namestr"><code>parse_variablereaction_namestr</code></a> to define the requested linking to <code>Domain</code> Variable.</li><li><code>linklocal_namestr::AbstractString</code>:  <code>&lt;linkreq_domain&gt;.[linkreq_subdomain.]localname</code>. Convenience form to define both <code>localname</code> and requested linking to Domain Variable, for the common case where <code>linkreq_name == localname</code>.</li><li><code>units::AbstractString</code>: units (&quot;&quot; if not applicable)</li><li><code>description::AbstractString</code>: text describing the variable</li></ul><p><strong>Keywords</strong></p><ul><li><code>attributes::Tuple(:attrb1name=&gt;attrb1value, :attrb2name=&gt;attrb2value, ...)</code>:  variable attributes, see <a href="../DomainsVariablesFields/#PALEOboxes.StandardAttributes"><code>StandardAttributes</code></a>, <a href="#PALEOboxes.set_attribute!"><code>set_attribute!</code></a>, <a href="../DomainsVariablesFields/#PALEOboxes.get_attribute"><code>get_attribute</code></a></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/886b8583b4b3ac24b4091fe42fa3002d474d64ae/src/VariableReaction.jl#L67-L89">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.parse_variablereaction_namestr" href="#PALEOboxes.parse_variablereaction_namestr"><code>PALEOboxes.parse_variablereaction_namestr</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">parse_variablereaction_namestr(linkstr) 
    -&gt; (linkreq_domain, linkreq_subdomain, linkreq_name, link_optional)</code></pre><p>Parse a linkstr into component parts.</p><p><code>linkstr</code> is of format: <code>[(][&lt;linkreq_domain&gt;.][&lt;linkreq_subdomain&gt;.]&lt;linkreq_name&gt;[)]</code></p><ul><li>Optional brackets <code>( ... )</code> set <code>link_optional=true</code></li><li><code>linkreq_name</code> may contain <code>%reaction%</code> which will later be substituted with <code>&lt;Reaction name&gt;/</code></li></ul><p><strong>Examples:</strong></p><pre><code class="language-julia-repl hljs">julia&gt; PALEOboxes.parse_variablereaction_namestr(&quot;foo&quot;)  # Common case eg for a property that should be public
(&quot;&quot;, &quot;&quot;, &quot;foo&quot;, false)

julia&gt; PALEOboxes.parse_variablereaction_namestr(&quot;%reaction%foo&quot;)  # Reaction-private by default
(&quot;&quot;, &quot;&quot;, &quot;%reaction%foo&quot;, false)

julia&gt; PALEOboxes.parse_variablereaction_namestr(&quot;ocean.foo&quot;)  # Request link to variable of same name in ocean Domain
(&quot;ocean&quot;, &quot;&quot;, &quot;foo&quot;, false)

julia&gt; PALEOboxes.parse_variablereaction_namestr(&quot;(ocean.oceansurface.goo)&quot;) # Full syntax
(&quot;ocean&quot;, &quot;oceansurface&quot;, &quot;goo&quot;, true)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/886b8583b4b3ac24b4091fe42fa3002d474d64ae/src/VariableReaction.jl#L716-L740">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.set_attribute!" href="#PALEOboxes.set_attribute!"><code>PALEOboxes.set_attribute!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">set_attribute!(var::VariableBase, name::Symbol, value, allow_create=false)</code></pre><p>Set Variable attribute.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/886b8583b4b3ac24b4091fe42fa3002d474d64ae/src/VariableAttributes.jl#L7-L11">source</a></section></article><h3 id="Defining-collections-of-VariableReactions"><a class="docs-heading-anchor" href="#Defining-collections-of-VariableReactions">Defining collections of VariableReactions</a><a id="Defining-collections-of-VariableReactions-1"></a><a class="docs-heading-anchor-permalink" href="#Defining-collections-of-VariableReactions" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.AbstractVarList" href="#PALEOboxes.AbstractVarList"><code>PALEOboxes.AbstractVarList</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">AbstractVarList</code></pre><p>Variables required by a <a href="#PALEOboxes.ReactionMethod"><code>ReactionMethod</code></a> <code>methodfn</code> are specified by  a Tuple of VarList_xxx &lt;: AbstractVarList, each containing a collection of <a href="../DomainsVariablesFields/#PALEOboxes.VariableReaction"><code>VariableReaction</code></a>.</p><p>These are then converted (by the <a href="#PALEOboxes.create_accessors"><code>create_accessors</code></a> method) to a corresponding Tuple of collections of views on Domain data arrays , which are then be passed to the <a href="#PALEOboxes.ReactionMethod"><code>ReactionMethod</code></a> <code>methodfn</code>.</p><p><strong>Implementation</strong></p><p>Subtypes of <code>AbstractVarList</code> should implement:</p><ul><li>a constructor that takes a collection of VariableReactions</li><li><code>create_accessors</code>, returning the views on Domain data arrays in a subtype-specific collection.</li><li><code>get_variables</code>, returning the collection of VariableReactions (as a flat list).</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/886b8583b4b3ac24b4091fe42fa3002d474d64ae/src/VariableReaction.jl#L291-L305">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.VarList_single" href="#PALEOboxes.VarList_single"><code>PALEOboxes.VarList_single</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">VarList_single(var; components=false) -&gt; VarList_single</code></pre><p>Create a <code>VarList_single</code> describing a single <code>VariableReaction</code>, <code>create_accessors</code> will then return a single accessor.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/886b8583b4b3ac24b4091fe42fa3002d474d64ae/src/VariableReaction.jl#L324-L329">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.VarList_namedtuple" href="#PALEOboxes.VarList_namedtuple"><code>PALEOboxes.VarList_namedtuple</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">VarList_namedtuple(varcollection; components=false) -&gt; VarList_namedtuple</code></pre><p>Create a <code>VarList_namedtuple</code> describing a collection of <code>VariableReaction</code>s, <code>create_accessors</code> will then return a NamedTuple with field names = <code>VariableReaction.localname</code> and field values = corresponding data arrays.</p><p>If <code>components = true</code>, each NamedTuple field will be a Vector of data array components.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/886b8583b4b3ac24b4091fe42fa3002d474d64ae/src/VariableReaction.jl#L384-L392">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.VarList_tuple" href="#PALEOboxes.VarList_tuple"><code>PALEOboxes.VarList_tuple</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">VarList_tuple(varcollection; components=false) -&gt; VarList_tuple</code></pre><p>Create a <code>VarList_tuple</code> describing a collection of <code>VariableReaction</code>s, <code>create_accessors</code> will then return a Tuple of data arrays.</p><p>If <code>components = true</code>, each Tuple field will be a Vector of data array components.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/886b8583b4b3ac24b4091fe42fa3002d474d64ae/src/VariableReaction.jl#L427-L434">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.VarList_vector" href="#PALEOboxes.VarList_vector"><code>PALEOboxes.VarList_vector</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">VarList_vector(varcollection; components=false, forceview=false) -&gt; VarList_vector</code></pre><p>Create a <code>VarList_vector</code> describing a collection of <code>VariableReaction</code>s, <code>create_accessors</code> will then return a Vector of data arrays.</p><p>If <code>components = true</code>, each Vector element will be a Vector of data array components.</p><p>If <code>forceview = true</code>, each accessor will be a 1-D <code>view</code> to help type stability, even if this is redundant (ie no <code>view</code> required, v::Vector -&gt; view(v, 1:length(v)))</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/886b8583b4b3ac24b4091fe42fa3002d474d64ae/src/VariableReaction.jl#L448-L458">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.VarList_vvector" href="#PALEOboxes.VarList_vvector"><code>PALEOboxes.VarList_vvector</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">VarList_vvector(Vector{Vector{VariableReaction}}::vars; components=false) -&gt; VarList_vvector</code></pre><p>Create a <code>VarList_vvector</code> describing a Vector of Vectors of <code>VariableReaction</code>s, <code>create_accessors</code> will then return a Vector of Vectors of data arrays.</p><p>If <code>components = true</code>, each Vector of Vectors element will be a Vector of data array components.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/886b8583b4b3ac24b4091fe42fa3002d474d64ae/src/VariableReaction.jl#L473-L480">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.VarList_nothing" href="#PALEOboxes.VarList_nothing"><code>PALEOboxes.VarList_nothing</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">VarList_nothing() -&gt; VarList_nothing</code></pre><p>Create a placeholder for a missing/unavailable VariableReaction. <code>create_accessors</code> will then return <code>nothing</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/886b8583b4b3ac24b4091fe42fa3002d474d64ae/src/VariableReaction.jl#L492-L497">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.VarList_tuple_nothing" href="#PALEOboxes.VarList_tuple_nothing"><code>PALEOboxes.VarList_tuple_nothing</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">VarList_tuple_nothing(nvar) -&gt; VarList_tuple_nothing</code></pre><p>Create a placeholder for <code>nvar</code> missing/unavailable VariableReactions. <code>create_accessors</code> will then return an <code>NTuple{nvar, Nothing}</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/886b8583b4b3ac24b4091fe42fa3002d474d64ae/src/VariableReaction.jl#L504-L509">source</a></section></article><h3 id="Registering-ReactionMethods"><a class="docs-heading-anchor" href="#Registering-ReactionMethods">Registering ReactionMethods</a><a id="Registering-ReactionMethods-1"></a><a class="docs-heading-anchor-permalink" href="#Registering-ReactionMethods" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.ReactionMethod" href="#PALEOboxes.ReactionMethod"><code>PALEOboxes.ReactionMethod</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">ReactionMethod</code></pre><p>Defines a callback function <code>methodfn</code> with Variables <code>vars</code>, to be called from the Model framework either during setup or as part of the main loop.</p><p><strong>Fields</strong></p><ul><li><code>methodfn::Function</code>: callback from Model framework</li><li><code>reaction::AbstractReaction</code>: the Reaction that created this ReactionMethod.</li><li><code>name::String</code>: a descriptive name, eg generated from the name of methodfn</li><li><code>vars::Tuple{Vararg{AbstractVarList}}</code>: <a href="#PALEOboxes.AbstractVarList"><code>AbstractVarList</code></a>s of <a href="../DomainsVariablesFields/#PALEOboxes.VariableReaction"><code>VariableReaction</code></a>s. Corresponding Variable accessors (views on Arrays) will be provided to the <code>methodfn</code> callback.</li><li><code>p::P</code>: optional context field (of arbitrary type) to store data needed by methodfn.</li><li><code>operatorID::Vector{Int64}</code>: operator ID (to allow operator splitting)</li><li><code>domain::Domain</code>: the Domain that <code>methodfn</code> operates on (ie will be called with <code>cellrange</code> for this <code>domain</code>).</li><li><code>preparefn::Function</code>: optional function to eg define buffers before main loop starts.</li></ul><p><strong>methodfn</strong></p><p>The <code>methodfn</code> callback is:</p><pre><code class="nohighlight hljs">methodfn(m::ReactionMethod, vardata::Tuple, cellrange::AbstractCellRange, modelctxt)</code></pre><p>With arguments:</p><ul><li><code>m::ReactionMethod</code>: context is available as <code>m.reaction::AbstractReaction</code> (the Reaction that defined the <code>ReactionMethod</code>), and <code>m.p</code> (an arbitrary extra context field supplied when <code>ReactionMethod</code> created).</li><li><code>vardata</code>: A Tuple of collections of views on Domain data arrays, defined by <code>vars</code></li><li><code>cellrange::AbstractCellRange</code>: range of cells to calculate.</li><li><code>modelctxt</code>:<ul><li>for a setup method, <code>:initial_value</code> or <code>:norm_value</code> defining the type of setup requested</li><li>for a main loop method <code>deltat</code> providing timestep information eg for rate throttling.</li></ul></li></ul><p><strong>preparefn</strong></p><p>An optional <code>preparefn</code> callback can be supplied eg to allocate buffers that require knowledge of the data types of <code>vardata</code> or to cache expensive calculations:</p><pre><code class="nohighlight hljs">preparefn(m::ReactionMethod, vardata::Tuple) -&gt; vardata</code></pre><p>This is called after model arrays are allocated, and prior to setup.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/886b8583b4b3ac24b4091fe42fa3002d474d64ae/src/ReactionMethod.jl#L6-L44">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.add_method_setup!" href="#PALEOboxes.add_method_setup!"><code>PALEOboxes.add_method_setup!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">add_method_setup!(reaction::AbstractReaction, method::AbstractReactionMethod)
add_method_setup!(reaction::AbstractReaction, methodfn::Function, vars::Tuple{Vararg{AbstractVarList}}; kwargs...) -&gt; ReactionMethod</code></pre><p>Add or create-and-add a setup method (called before main loop) eg to set persistent data or initialize state variables. <code>methodfn</code>, <code>vars</code>, <code>kwargs</code> are passed to <a href="#PALEOboxes.ReactionMethod"><code>ReactionMethod</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/886b8583b4b3ac24b4091fe42fa3002d474d64ae/src/Reaction.jl#L259-L265">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.add_method_initialize!" href="#PALEOboxes.add_method_initialize!"><code>PALEOboxes.add_method_initialize!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">add_method_initialize!(reaction::AbstractReaction, method::AbstractReactionMethod)
add_method_initialize!(reaction::AbstractReaction, methodfn::Function, vars::Tuple{Vararg{AbstractVarList}}; kwargs...) -&gt; ReactionMethod</code></pre><p>Add or create-and-add an initialize method (called at start of each main loop iteration)  eg to zero out accumulator Variables. <code>methodfn</code>, <code>vars</code>, <code>kwargs</code> are passed to <a href="#PALEOboxes.ReactionMethod"><code>ReactionMethod</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/886b8583b4b3ac24b4091fe42fa3002d474d64ae/src/Reaction.jl#L274-L281">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.add_method_do!" href="#PALEOboxes.add_method_do!"><code>PALEOboxes.add_method_do!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">add_method_do!(reaction::AbstractReaction, method::AbstractReactionMethod)
add_method_do!(reaction::AbstractReaction, methodfn::Function, vars::Tuple{Vararg{AbstractVarList}}; kwargs...) -&gt; ReactionMethod</code></pre><p>Add or create and add a main loop method. <code>methodfn</code>, <code>vars</code>, <code>kwargs</code> are passed to <a href="#PALEOboxes.ReactionMethod"><code>ReactionMethod</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/886b8583b4b3ac24b4091fe42fa3002d474d64ae/src/Reaction.jl#L291-L297">source</a></section></article><h2 id="Predefined-ReactionMethods"><a class="docs-heading-anchor" href="#Predefined-ReactionMethods">Predefined ReactionMethods</a><a id="Predefined-ReactionMethods-1"></a><a class="docs-heading-anchor-permalink" href="#Predefined-ReactionMethods" title="Permalink"></a></h2><h3 id="Setup-and-initialization-of-Variables"><a class="docs-heading-anchor" href="#Setup-and-initialization-of-Variables">Setup and initialization of Variables</a><a id="Setup-and-initialization-of-Variables-1"></a><a class="docs-heading-anchor-permalink" href="#Setup-and-initialization-of-Variables" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.add_method_setup_initialvalue_vars_default!" href="#PALEOboxes.add_method_setup_initialvalue_vars_default!"><code>PALEOboxes.add_method_setup_initialvalue_vars_default!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">add_method_setup_initialvalue_vars_default!(react::AbstractReaction, variables [; kwargs...])</code></pre><p>Create and add a default method to initialize Variables matching <code>filterfn</code> (defaults to state Variables) to Attribute :initial_value at beginning of integration.</p><p><strong>Keywords</strong></p><ul><li><code>filterfn</code>: set to f(var)::Bool to override the default selection on :vfunction for state variables.</li><li><code>transfer_attribute_vars=[]</code>: Set to a list of the same length as <code>variables</code> to initialise <code>variables</code> from attributes of <code>transfer_attribute_vars</code>.</li><li><code>setup_callback=(method, attribute_value, var, vardata) -&gt; nothing</code>: Set to a function that is called  after each Variable initialisation eg to store norm values.</li><li><code>convertvars=[]</code></li><li><code>convertfn = (convertvars_tuple, i) -&gt; 1.0</code></li><li><code>convertinfo = &quot;&quot;</code></li></ul><p><strong>Including volume etc conversion</strong></p><p>Set <code>convertvars</code> to a Vector of Variables (eg for cell volume) and supply <code>convertfn</code> and <code>convertinfo</code>  to initialize to <code>:initial_value*convertfn(convertvars_tuple, i)</code> where the argument of <code>convertfn</code> is the Tuple generated by <code>VarList_tuple(convertvars)</code>.</p><p>Example: To interpret :initial_value as a concentration-like quantity:</p><pre><code class="nohighlight hljs">convertvars = [volume], 
convertfn = ((volume, ), i) -&gt; volume[i], 
convertinfo = &quot; * volume&quot;</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/886b8583b4b3ac24b4091fe42fa3002d474d64ae/src/reactionmethods/SetupInitializeUtilityMethods.jl#L5-L32">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.add_method_initialize_zero_vars_default!" href="#PALEOboxes.add_method_initialize_zero_vars_default!"><code>PALEOboxes.add_method_initialize_zero_vars_default!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">add_method_initialize_zero_vars_default!(react::AbstractReaction, variables=PB.get_variables(react))</code></pre><p>Create and add a default method to initialize Variables to zero at beginning of each timestep. Defaults to adding all Variables from <code>react</code> with <code>:initialize_to_zero</code> attribute <code>true</code>.</p><p>NB: TODO variables are converted to VarDep (no dependency checking or sorting needed, could define a VarInit or similar?)</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/886b8583b4b3ac24b4091fe42fa3002d474d64ae/src/reactionmethods/SetupInitializeUtilityMethods.jl#L112-L119">source</a></section></article><h3 id="Adding-totals-for-Variables"><a class="docs-heading-anchor" href="#Adding-totals-for-Variables">Adding totals for Variables</a><a id="Adding-totals-for-Variables-1"></a><a class="docs-heading-anchor-permalink" href="#Adding-totals-for-Variables" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.add_method_do_totals_default!" href="#PALEOboxes.add_method_do_totals_default!"><code>PALEOboxes.add_method_do_totals_default!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">add_method_do_totals_default!(react::AbstractReaction, variables=PB.get_variables(react))</code></pre><p>Create and add a default method to initialize Variables to zero at beginning of each timestep. Defaults to adding all Variables from <code>react</code> with <code>:initialize_to_zero</code> attribute <code>true</code>.</p><p>NB: TODO variables are converted to VarDep (no dependency checking or sorting needed, could define a VarInit or similar?)</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/886b8583b4b3ac24b4091fe42fa3002d474d64ae/src/reactionmethods/VariableStatsMethods.jl#L1-L8">source</a></section></article><h3 id="Chemical-reactions"><a class="docs-heading-anchor" href="#Chemical-reactions">Chemical reactions</a><a id="Chemical-reactions-1"></a><a class="docs-heading-anchor-permalink" href="#Chemical-reactions" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.RateStoich" href="#PALEOboxes.RateStoich"><code>PALEOboxes.RateStoich</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">RateStoich(ratevartemplate, stoich_statevarname; deltavarname_eta=nothing,
           sms_prefix=&quot;&quot;, sms_suffix=&quot;_sms&quot;) -&gt; RateStoich</code></pre><p>Calculate fluxes for a biogeochemical reaction given rate, stoichiometry, and optionally isotope eta.</p><p>Add to a Reaction using <a href="#PALEOboxes.create_ratestoich_method"><code>create_ratestoich_method</code></a> and <a href="#PALEOboxes.add_method_do!"><code>add_method_do!</code></a>.  </p><p>A Property Variable should be set to provide the reaction rate (often this is implemented by another method of the same Reaction).</p><p>This method will then link to that (using the local and link names supplied by <code>ratevartemplate</code>) and calculate the appropriate product rates, omitting products that are not present (<code>VariableReaction</code> not linked) in the <code>Model</code> configuration.</p><p><strong>Arguments:</strong></p><ul><li><code>ratevartemplate::Union{VarPropT, VarDepT}</code>: used to define the rate variable local and link names.</li><li><code>stoich_statevarname</code>: collection of Tuple(stoichiometry, name) eg ((-2.0, &quot;O2&quot;), (-1.0,&quot;H2S::Isotope&quot;), (1.0, &quot;SO4::Isotope&quot;))</li><li><code>deltavarname_eta</code>: optional tuple of variable delta + eta (&quot;SO4_delta&quot;, -30.0) or (&quot;SO4_delta&quot;, rj.pars.delta). If a Parameter is supplied, this is read in <code>do_react_ratestoich</code> to allow modification.</li></ul><p><strong>Examples:</strong></p><p>Create a <code>RateStoich</code> representing the reaction   2 O2 + H2S -&gt; H2SO4</p><pre><code class="language-julia-repl hljs">julia&gt; myratevar = PALEOboxes.VarProp(&quot;myrate&quot;, &quot;mol yr-1&quot;, &quot;a rate&quot;);

julia&gt; rs = PALEOboxes.RateStoich(myratevar, ((-2.0, &quot;O2&quot;), (-1.0,&quot;H2S&quot;), (1.0, &quot;SO4&quot;)));

julia&gt; rs.stoich_statevarname
((-2.0, &quot;O2&quot;), (-1.0, &quot;H2S&quot;), (1.0, &quot;SO4&quot;))</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/886b8583b4b3ac24b4091fe42fa3002d474d64ae/src/reactionmethods/RateStoich.jl#L2-L31">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.create_ratestoich_method" href="#PALEOboxes.create_ratestoich_method"><code>PALEOboxes.create_ratestoich_method</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">create_ratestoich_method(reaction::AbstractReaction, ratestoich::RateStoich; isotope_data=ScalarData)
    -&gt; ReactionMethod</code></pre><p>Create method (see <a href="#PALEOboxes.RateStoich"><code>RateStoich</code></a>).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/886b8583b4b3ac24b4091fe42fa3002d474d64ae/src/reactionmethods/RateStoich.jl#L102-L107">source</a></section></article><h2 id="Implementing-Reaction-method-functions"><a class="docs-heading-anchor" href="#Implementing-Reaction-method-functions">Implementing Reaction method functions</a><a id="Implementing-Reaction-method-functions-1"></a><a class="docs-heading-anchor-permalink" href="#Implementing-Reaction-method-functions" title="Permalink"></a></h2><p>Method functions should iterate over cells using the supplied <code>cellrange.indices</code>.</p><h3 id="Optimising-loops-over-cells-using-explicit-SIMD-instructions"><a class="docs-heading-anchor" href="#Optimising-loops-over-cells-using-explicit-SIMD-instructions">Optimising loops over cells using explicit SIMD instructions</a><a id="Optimising-loops-over-cells-using-explicit-SIMD-instructions-1"></a><a class="docs-heading-anchor-permalink" href="#Optimising-loops-over-cells-using-explicit-SIMD-instructions" title="Permalink"></a></h3><p>Reactions with simple loops over <code>cellindices</code> that implement time-consuming per-cell calculations  may be optimised by using explicit SIMD instructions.</p><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.SIMDutils.SIMDIter" href="#PALEOboxes.SIMDutils.SIMDIter"><code>PALEOboxes.SIMDutils.SIMDIter</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">SIMDIter(baseiter, Val{N})
SIMDIter(baseiter, ::Type{SIMD.Vec{N, U}})
SIMDIter(baseiter, ::Val{1}) # scalar fallback
SIMDIter(baseiter, ::Type{U}) where {U &lt;: Real} # scalar fallback</code></pre><p>Iterator that takes up to <code>N</code> SIMD elements at a time from <code>baseiter</code> (which should represent indices into a Vector). See Julia package <a href="https://github.com/eschnett/SIMD.jl">SIMD.jl</a></p><p>If <code>baseiter</code> contained 1 or more but less then <code>N</code> elements, then <code>indices</code> is filled with repeats of the last available element.</p><p>Returns Tuple <code>indices</code> (length <code>N</code>).</p><p><strong>Examples</strong></p><pre><code class="nohighlight hljs">v_a = [1.0, 2.0, 3.0, 4.0, 5.0]
v_b = similar(v_a)

iter = eachindex(v_a) # iter should represent indices into a Vector

# simplest version - Float64 x 4, ie type of v_a x 4

for indvec in SIMDIter(iter, Val(4))
    x = v_a[indvec]  # x is a packed SIMD vector
    v_b[indvec] = x
end


# with type conversion - Float32 x 8, ie explicitly change Type of SIMD vector

ST = SIMD.Vec{8, Float32}}    
for indvec in SIMDIter(iter, ST)
    #   v = vec[indvec]  &lt;--&gt; vgatherind(ST, vec, indvec)
    #   vec[indvec] = v  &lt;--&gt; vscatterind!(v, vec, indvec)
    #   vec[indvec] += v &lt;--&gt; vaddind!(v, vec, indvec) 

    x = vgatherind(ST, v_a, indices)  # x is a packed SIMD vector with type conversion to Float32
    vscatterind!(x, v_b, indices)
end</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/886b8583b4b3ac24b4091fe42fa3002d474d64ae/src/utils/SIMDutils.jl#L27-L69">source</a></section></article><h2 id="Internal-details-of-Variable-arrays-accessor-generation"><a class="docs-heading-anchor" href="#Internal-details-of-Variable-arrays-accessor-generation">Internal details of Variable arrays accessor generation</a><a id="Internal-details-of-Variable-arrays-accessor-generation-1"></a><a class="docs-heading-anchor-permalink" href="#Internal-details-of-Variable-arrays-accessor-generation" title="Permalink"></a></h2><p><a href="../DomainsVariablesFields/#PALEOboxes.VariableReaction"><code>VariableReaction</code></a>s in the <a href="#PALEOboxes.AbstractVarList"><code>AbstractVarList</code></a>s for a <a href="#PALEOboxes.ReactionMethod"><code>ReactionMethod</code></a> are processed by <a href="#PALEOboxes.create_accessor"><code>create_accessor</code></a> to supply <code>view</code>s on arrays as corresponding arguments to the <a href="#PALEOboxes.ReactionMethod"><code>ReactionMethod</code></a> function.</p><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.create_accessor" href="#PALEOboxes.create_accessor"><code>PALEOboxes.create_accessor</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs"> create_accessor(var::VariableReaction, modeldata, components, [,forceview=false])
    -&gt; accessor or (accessor, subdomain_indices)</code></pre><p>Creates a <code>view</code> on a (single) <a href="../DomainsVariablesFields/#PALEOboxes.VariableDomain"><code>VariableDomain</code></a> data array linked by <code>var::</code><a href="../DomainsVariablesFields/#PALEOboxes.VariableReaction"><code>VariableReaction</code></a>. Called by an <a href="#PALEOboxes.AbstractVarList"><code>AbstractVarList</code></a> <a href="#PALEOboxes.create_accessors"><code>create_accessors</code></a> implementation to generate a collection of <code>views</code> for multiple <a href="../DomainsVariablesFields/#PALEOboxes.VariableReaction"><code>VariableReaction</code></a>s.</p><p>Returns:</p><ul><li>if <code>var</code> is linked, an <code>accessor</code> or Tuple <code>(accessor, subdomain_indices)</code> that provides a <code>view</code> on variable data.</li><li>if <code>var</code> is not linked, <code>nothing</code> if <code>var</code> is optional, or errors and doesn&#39;t return if <code>var</code> is non-optional.</li></ul><p>Mapping of indices for Subdomains &lt;–&gt; Domains:</p><ul><li>if no Subdomain, returns unmodified indices (if <code>forceview=false</code>),    or an equivalent view (if <code>forceview=true</code>, this is to help type stability) </li><li>if Variable is a Domain interior and Subdomain is a Domain boundary,   <code>accessor</code> is a view with a subset of Domain indices.</li><li>if Variable is a Domain boundary and Subdomain is the Domain interior,   returns a Tuple with <code>subdomain_indices</code>,  length(Subdomain size), with <code>missing</code> for interior points.</li></ul><p>Mapping of multi-component (Isotope) Variables:</p><ul><li>If <code>components=false</code>:<ul><li>map multi-component Variable to <code>accessor::IsotopeArray</code></li><li>return a single-component Variable as a <code>accessor::AbstractArray</code>. </li></ul></li><li>If <code>components=true</code>:<ul><li>variable data as a <code>accessor::Vector{Array}</code>, length=number of components</li></ul></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/886b8583b4b3ac24b4091fe42fa3002d474d64ae/src/VariableReaction.jl#L550-L576">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.create_accessors" href="#PALEOboxes.create_accessors"><code>PALEOboxes.create_accessors</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">create_accessors(va::AbstractVarList, modeldata::AbstractModelData) -&gt; collection of views</code></pre><p>Call <a href="#PALEOboxes.create_accessor"><code>create_accessor</code></a> to return a collection of views on Domain data arrays for VariableReaction in <code>va</code>. Collection and view are determined by <code>va</code> Type.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/886b8583b4b3ac24b4091fe42fa3002d474d64ae/src/VariableReaction.jl#L309-L314">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../Solver API/">« Solver API</a><a class="docs-footer-nextpage" href="../ReactionCatalog/">Generic Reaction catalog »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.17 on <span class="colophon-date" title="Sunday 15 May 2022 13:27">Sunday 15 May 2022</span>. Using Julia version 1.6.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
