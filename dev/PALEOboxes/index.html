<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>PALEOboxes · PALEOboxes Documentation</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">PALEOboxes Documentation</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Design</span><ul><li><a class="tocitem" href="../DesignOverview/">Outline of PALEO design</a></li><li><a class="tocitem" href="../CreateInitializeLoop/">Control flow</a></li></ul></li><li><span class="tocitem">Reference</span><ul><li class="is-active"><a class="tocitem" href>PALEOboxes</a><ul class="internal"><li><a class="tocitem" href="#Model"><span>Model</span></a></li><li><a class="tocitem" href="#Domains"><span>Domains</span></a></li><li><a class="tocitem" href="#Variables"><span>Variables</span></a></li><li><a class="tocitem" href="#Reactions"><span>Reactions</span></a></li><li><a class="tocitem" href="#Reservoirs"><span>Reservoirs</span></a></li><li><a class="tocitem" href="#Variable-Statistics"><span>Variable Statistics</span></a></li><li><a class="tocitem" href="#Fluxes"><span>Fluxes</span></a></li></ul></li></ul></li><li><a class="tocitem" href="../References/">References</a></li><li><a class="tocitem" href="../indexpage/">Index</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Reference</a></li><li class="is-active"><a href>PALEOboxes</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>PALEOboxes</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/master/docs/src/PALEOboxes.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="PALEOboxes"><a class="docs-heading-anchor" href="#PALEOboxes">PALEOboxes</a><a id="PALEOboxes-1"></a><a class="docs-heading-anchor-permalink" href="#PALEOboxes" title="Permalink"></a></h1><p>PALEOboxes provides a coupler for model components.</p><p>A <a href="#PALEOboxes.Model"><code>Model</code></a> contains <a href="#PALEOboxes.Domain"><code>Domain</code></a>s, each of which contain <a href="#Variables">Variables</a> defining <a href="#PALEOboxes.Field"><code>Field</code></a>s, and <a href="#Reactions">Reactions</a> with <a href="#PALEOboxes.ReactionMethod"><code>ReactionMethod</code></a>s that operate on the <a href="#PALEOboxes.Field"><code>Field</code></a>s to calculate model time evolution.</p><h2 id="Model"><a class="docs-heading-anchor" href="#Model">Model</a><a id="Model-1"></a><a class="docs-heading-anchor-permalink" href="#Model" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.Model" href="#PALEOboxes.Model"><code>PALEOboxes.Model</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">Model</code></pre><p>A biogeochemical model consisting of <a href="#PALEOboxes.Domain"><code>Domain</code></a>s, created from a <a href="https://en.wikipedia.org/wiki/YAML">YAML</a> configuration file using <a href="#PALEOboxes.create_model_from_config-Tuple{AbstractString, AbstractString}"><code>create_model_from_config</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Model.jl#L6-L11">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.get_domain" href="#PALEOboxes.get_domain"><code>PALEOboxes.get_domain</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">get_domain(model::Model, name::AbstractString) -&gt; Domain or nothing
get_domain(model::Model, domainid) -&gt; Domain</code></pre><p>Get Domain by <code>name</code> (may be nothing if <code>name</code> not matched) or <code>domainid</code> (range 1:num_domains).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Model.jl#L29-L35">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.get_reaction-Tuple{PALEOboxes.Model, Any, Any}" href="#PALEOboxes.get_reaction-Tuple{PALEOboxes.Model, Any, Any}"><code>PALEOboxes.get_reaction</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">get_reaction(model::Model, domainname, reactionname) -&gt; Reaction or nothing</code></pre><p>Get Reaction by domainname and reaction name</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Model.jl#L62-L66">source</a></section></article><h3 id="Initialization"><a class="docs-heading-anchor" href="#Initialization">Initialization</a><a id="Initialization-1"></a><a class="docs-heading-anchor-permalink" href="#Initialization" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.create_model_from_config-Tuple{AbstractString, AbstractString}" href="#PALEOboxes.create_model_from_config-Tuple{AbstractString, AbstractString}"><code>PALEOboxes.create_model_from_config</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">create_model_from_config(
    config_file::AbstractString, configmodel::AbstractString;
    modelpars::Dict = Dict()
) -&gt; model::Model

create_model_from_config(
    config_files,
    configmodel::AbstractString;
    modelpars::Dict = Dict()
) -&gt; model::Model</code></pre><p>Construct model from a single <a href="https://en.wikipedia.org/wiki/YAML">YAML</a> <code>config_file</code>, or from a collection of <code>config_files</code>,  which are read in order and concatenated before being parsed as yaml.</p><p>Optional argument <code>modelpars</code> provides parameters that override those in <code>&lt;configmodel&gt;:</code> <code>parameters:</code> section.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Model.jl#L199-L215">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.create_modeldata" href="#PALEOboxes.create_modeldata"><code>PALEOboxes.create_modeldata</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">create_modeldata(model::Model [, eltype] [; threadsafe]) -&gt; modeldata::ModelData</code></pre><p>Create a new <a href="#PALEOboxes.ModelData"><code>ModelData</code></a> struct for model variables of element type <code>eltype</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Model.jl#L311-L315">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.ModelData" href="#PALEOboxes.ModelData"><code>PALEOboxes.ModelData</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">ModelData{T}</code></pre><p>Contains <code>model</code> data arrays of element type T.</p><p><strong>Fields</strong></p><ul><li><code>cellranges_all::Vector{AbstractCellRange}</code>: default cellranges covering all domains</li><li><code>dispatchlists_all</code>: default dispatchlists covering all domains</li><li><code>solver_view_all::SolverView{T}</code>: an optional default <a href="#PALEOboxes.SolverView"><code>SolverView</code></a> covering all domains (created by <a href="#PALEOboxes.set_default_solver_view!"><code>set_default_solver_view!</code></a>).</li><li><code>hostep_data</code>: optional NamedTuple with data arrays for host-dependent non-state Variables (eg for <code>tforce</code>, if defined).</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/ModelData.jl#L22-L33">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.allocate_variables!" href="#PALEOboxes.allocate_variables!"><code>PALEOboxes.allocate_variables!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">allocate_variables!(model, modeldata; [hostdep] [,eltypemap])</code></pre><p>Allocate memory for Domain variables for every Domain in <code>model</code>.</p><p>See <a href="#PALEOboxes.allocate_variables!"><code>allocate_variables!(domain::Domain, modeldata::AbstractModelData)</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Model.jl#L347-L353">source</a></section><section><div><pre><code class="nohighlight hljs">allocate_variables!(domain, modeldata; [hostdep=false] [, eltypemap::Dict{String, DataType}])</code></pre><p>Allocate memory for Domain Variables. </p><p>If <code>hostdep=false</code>, only internal Variables are allocated, allowing host-dependent Variables (usually state Variables and derivatives + any external dependencies) to be set to views on host-managed arrays.</p><p>Element type of allocated Arrays is determined by <code>eltype(modeldata)</code> (the usual case, allowing use of AD types),  or Variable <code>:datatype</code> attribute if present (allowing Variables to ignore AD types). <code>:datatype</code> may be either a Julia <code>DataType</code> (eg Float64), or a string to be looked up in <code>eltypemap</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Domain.jl#L170-L181">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.check_ready-Tuple{PALEOboxes.Model, PALEOboxes.AbstractModelData}" href="#PALEOboxes.check_ready-Tuple{PALEOboxes.Model, PALEOboxes.AbstractModelData}"><code>PALEOboxes.check_ready</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">check_ready(model, modeldata; [throw_on_error=true] [, check_hostdep_varnames=true] [, expect_hostdep_varnames=[&quot;global.tforce&quot;]]) -&gt; ready</code></pre><p>Check all variable pointers set, and no unexpected host-dependent non-state Variables (ie unlinked Variables)</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Model.jl#L373-L377">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.check_configuration-Tuple{PALEOboxes.Model}" href="#PALEOboxes.check_configuration-Tuple{PALEOboxes.Model}"><code>PALEOboxes.check_configuration</code></a> — <span class="docstring-category">Method</span></header><section><div><p>Check configuration</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Model.jl#L412">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.initialize_reactiondata!-Tuple{PALEOboxes.Model, PALEOboxes.AbstractModelData}" href="#PALEOboxes.initialize_reactiondata!-Tuple{PALEOboxes.Model, PALEOboxes.AbstractModelData}"><code>PALEOboxes.initialize_reactiondata!</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">initialize_reactiondata!(model::Model, modeldata::AbstractModelData)</code></pre><p>Processes <code>VarList_...</code>s from ReactionMethods and populates <code>modeldata.sorted_methodsdata_...</code> with sorted lists of ReactionMethods and corresponding Variable accessors.</p><p>Calls <code>create_dispatch_methodlists(model, modeldata, modeldata.cellranges_all)</code> to set <code>modeldata.dispatchlists_all</code> to (optional) default  ReactionMethodDispatchLists for entire model.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Model.jl#L431-L439">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.dispatch_setup" href="#PALEOboxes.dispatch_setup"><code>PALEOboxes.dispatch_setup</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">dispatch_setup(model, attribute_value, modeldata, cellranges=modeldata.cellranges_all)</code></pre><p>Call setup methods, eg to initialize data arrays (including state variables).</p><p><code>attribute_value</code> (<code>:initial_value</code> or <code>:norm_value</code>) defines the Variable attribute to read from the configuration file and use to set data arrays. Usually <code>dispatch_setup</code> is called twice, first to get <code>:norm_value</code> and then to get <code>:initial_value</code>. </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Model.jl#L484-L491">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.create_dispatch_methodlists" href="#PALEOboxes.create_dispatch_methodlists"><code>PALEOboxes.create_dispatch_methodlists</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">create_dispatch_methodlists(model::Model, modeldata::AbstractModelData, cellranges) 
    -&gt; (;list_initialize::ReactionMethodDispatchList, list_do::ReactionMethodDispatchList)</code></pre><p>Compile lists of <code>initialize</code> and <code>do</code> methods + corresponding <code>cellrange</code> for main loop <a href="#PALEOboxes.do_deriv"><code>do_deriv</code></a>.</p><p>Subset of methods and cellrange to operate on are generated from supplied <code>cellranges</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Model.jl#L514-L521">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.ReactionMethodDispatchList" href="#PALEOboxes.ReactionMethodDispatchList"><code>PALEOboxes.ReactionMethodDispatchList</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">ReactionMethodDispatchList</code></pre><p>Defines a list of <a href="#PALEOboxes.ReactionMethod"><code>ReactionMethod</code></a> with corresponding <a href="#PALEOboxes.CellRange"><code>CellRange</code></a> and views on Variable data (sub)arrays.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Types.jl#L210-L215">source</a></section></article><h3 id="Attaching-numerical-solvers"><a class="docs-heading-anchor" href="#Attaching-numerical-solvers">Attaching numerical solvers</a><a id="Attaching-numerical-solvers-1"></a><a class="docs-heading-anchor-permalink" href="#Attaching-numerical-solvers" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.SolverView" href="#PALEOboxes.SolverView"><code>PALEOboxes.SolverView</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">SolverView</code></pre><p>Provides a view on the whole or some part of the Model for a numerical solver. Contains <a href="#PALEOboxes.VariableAggregator"><code>VariableAggregator</code></a>s for a subset of spatial locations  (Domains, indices within spatial Domains) and Variables, with:</p><ul><li>ODE paired <code>stateexplicit</code> (S) and <code>stateexplicit_deriv</code> (dS/dt), where dS/dt = F(S).</li><li>Implicit-ODE paired <code>total</code> (T) and <code>total_deriv</code> (dT/dt), where dT(S)/dt = F(T(S)) with <code>total</code> a function of explicit and implicit state Variables <code>statexplicit</code> and <code>state</code> (S).</li><li>Algebraic <code>constraint</code>s (C), where C(S) = 0 with C a function of explicit and implicit state Variables <code>statexplicit</code> and <code>state</code> (S),</li></ul><p>The number of <code>total</code> + number of <code>constraint</code> Variables must equal the number of implicit <code>state</code> Variables.</p><p>Optional access methods provide an <code>ODE/DAE solver</code> view with composite <code>statevar</code> and <code>statevar_sms</code>, where:</p><ul><li><code>statevar</code> is a concatenation of <code>stateexplicit</code> and <code>state</code> (<a href="#PALEOboxes.set_statevar!"><code>set_statevar!</code></a>)</li><li><code>statevar_sms</code> is a concatenation of <code>stateexplicit_deriv</code>, <code>total_deriv</code>, <code>constraints</code> (<a href="#PALEOboxes.get_statevar_sms!"><code>get_statevar_sms!</code></a>)</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/SolverView.jl#L1-L19">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.VariableAggregator" href="#PALEOboxes.VariableAggregator"><code>PALEOboxes.VariableAggregator</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">VariableAggregator{T, F, C}</code></pre><p>Aggregate multiple VariableDomains into a contiguous Vector for use by a numerical solver.</p><p>Access as a contiguous Vector using <code>copyto!(va::VariableAggregator, x)</code> and <code>copyto!(x, va::VariableAggregator)</code></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/VariableAggregator.jl#L4-L10">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.VariableAggregator-Tuple{Any, Any, Any}" href="#PALEOboxes.VariableAggregator-Tuple{Any, Any, Any}"><code>PALEOboxes.VariableAggregator</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">VariableAggregator(vars, cellranges, modeldata)</code></pre><p>Create a <a href="#PALEOboxes.VariableAggregator"><code>VariableAggregator</code></a> for collection of Variables <code>vars</code>, with indices from corresponding <code>cellranges</code>, for <code>modeldata</code>.</p><p><code>cellranges</code> may contain <code>nothing</code> entries to indicate whole Domain.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/VariableAggregator.jl#L23-L30">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.create_solver_view" href="#PALEOboxes.create_solver_view"><code>PALEOboxes.create_solver_view</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">create_solver_view(model, modeldata; [verbose=true]) 
    -&gt; SolverView
create_solver_view(model, modeldata, cellranges; [verbose=false], [indices_from_cellranges=true])
    -&gt; SolverView</code></pre><p>Create a <a href="#PALEOboxes.SolverView"><code>SolverView</code></a> for the entire model, or for a subset of Model Variables defined by the Domains and operatorIDs of <code>cellranges</code>. </p><p><strong>Keywords</strong></p><ul><li><code>indices_from_cellranges=true</code>: true to restrict to the index ranges from <code>cellranges</code>, false to just use <code>cellranges</code> to define Domains</li></ul><p>and take the whole of each Domain.</p><ul><li><code>hostdep_all=true</code>: true to include host dependent not-state Variables from all Domains</li><li><code>reallocate_hostdep_eltype=Float64</code>: a data type to reallocate <code>hostdep</code> Variables eg to replace any</li></ul><p>AD types.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/SolverView.jl#L203-L218">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.set_default_solver_view!" href="#PALEOboxes.set_default_solver_view!"><code>PALEOboxes.set_default_solver_view!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">set_default_solver_view!(model, modeldata)</code></pre><p>(Optional, used to set <code>modeldata.solver_view_all</code> to a <a href="#PALEOboxes.SolverView"><code>SolverView</code></a>) for the whole model, and set <code>modeldata.hostdep_data</code> to any non-state-variable host dependent Variables)</p><p><code>reallocate_hostdep_eltype</code> a data type to reallocate <code>hostdep_data</code> eg to replace any AD types.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/SolverView.jl#L317-L325">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.copy_norm!" href="#PALEOboxes.copy_norm!"><code>PALEOboxes.copy_norm!</code></a> — <span class="docstring-category">Function</span></header><section><div><p>copy norm values from state variable etc data</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/SolverView.jl#L176">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.set_statevar!" href="#PALEOboxes.set_statevar!"><code>PALEOboxes.set_statevar!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">set_statevar!(sv::SolverView, u)</code></pre><p>Set combined stateexplicit, state variables from u</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/SolverView.jl#L98-L102">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.get_statevar_sms!" href="#PALEOboxes.get_statevar_sms!"><code>PALEOboxes.get_statevar_sms!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">get_statevar_sms!(du, sv::SolverView)</code></pre><p>Get combined derivatives and constraints, eg for an ODE solver</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/SolverView.jl#L135-L139">source</a></section></article><h3 id="Main-loop"><a class="docs-heading-anchor" href="#Main-loop">Main loop</a><a id="Main-loop-1"></a><a class="docs-heading-anchor-permalink" href="#Main-loop" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.set_tforce!" href="#PALEOboxes.set_tforce!"><code>PALEOboxes.set_tforce!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">set_tforce!(van::VariableAggregatorNamed, val; allow_missing::Bool=true)</code></pre><p>Optimised non-allocating version of <code>set_values!(van, :global, :tforce, val)</code></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/VariableAggregator.jl#L272-L276">source</a></section><section><div><pre><code class="nohighlight hljs">set_tforce!(sv::SolverView, t)</code></pre><p>Set <code>global.tforce</code> model time (if defined) from t.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/SolverView.jl#L195-L199">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.do_deriv" href="#PALEOboxes.do_deriv"><code>PALEOboxes.do_deriv</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">do_deriv(dispatchlists, deltat::Float64=0.0)</code></pre><p>Wrapper function to calculate entire derivative (initialize and do methods) in one call. <code>dispatchlists</code> is from <a href="#PALEOboxes.create_dispatch_methodlists"><code>create_dispatch_methodlists</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Model.jl#L579-L584">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.dispatch_methodlist" href="#PALEOboxes.dispatch_methodlist"><code>PALEOboxes.dispatch_methodlist</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">dispatch_methodlist(dl::ReactionMethodDispatchList, deltat::Float64=0.0)</code></pre><p>Dispatch to a list of methods.</p><p><strong>Implementation</strong></p><p>As an optimisation, uses @generated for Type stability and to avoid dynamic dispatch, instead of iterating over lists.</p><p><a href="#PALEOboxes.ReactionMethodDispatchList"><code>ReactionMethodDispatchList</code></a> fields are Tuples hence are fully Typed, the @generated function emits unrolled code with a function call for each Tuple element. </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Model.jl#L595-L607">source</a></section></article><h3 id="Diagnostics"><a class="docs-heading-anchor" href="#Diagnostics">Diagnostics</a><a id="Diagnostics-1"></a><a class="docs-heading-anchor-permalink" href="#Diagnostics" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.show_methods_setup" href="#PALEOboxes.show_methods_setup"><code>PALEOboxes.show_methods_setup</code></a> — <span class="docstring-category">Function</span></header><section><div><p>display reaction order</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Model.jl#L645">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.show_methods_initialize" href="#PALEOboxes.show_methods_initialize"><code>PALEOboxes.show_methods_initialize</code></a> — <span class="docstring-category">Function</span></header><section><div><p>display reaction order</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Model.jl#L652">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.show_methods_do" href="#PALEOboxes.show_methods_do"><code>PALEOboxes.show_methods_do</code></a> — <span class="docstring-category">Function</span></header><section><div><p>display reaction order</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Model.jl#L659">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.show_variables" href="#PALEOboxes.show_variables"><code>PALEOboxes.show_variables</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">show_variables(obj, ...) -&gt; Table</code></pre><p>Show all Variables attached to PALEO object <code>obj</code></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Types.jl#L66-L70">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.show_parameters" href="#PALEOboxes.show_parameters"><code>PALEOboxes.show_parameters</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">show_parameters(model) -&gt; DataFrame</code></pre><p>Get parameters for all reactions in model.</p><p><strong>Examples:</strong></p><p>Show all model parameters using VS Code table viewer:</p><pre><code class="nohighlight hljs">julia&gt; vscodedisplay(PB.show_parameters(run.model))</code></pre><p>Write out all model parameters as csv for import to a spreadsheet:</p><pre><code class="nohighlight hljs">julia&gt; CSV.write(&quot;pars.csv&quot;, PB.show_parameters(run.model))</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Model.jl#L704-L717">source</a></section><section><div><pre><code class="nohighlight hljs">show_parameters(react::AbstractReaction) -&gt; DataFrame
show_parameters(classname::AbstractString) -&gt; DataFrame</code></pre><p>list all parameters for a Reaction <code>react</code> instance or <code>classname</code></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Reaction.jl#L552-L557">source</a></section></article><h2 id="Domains"><a class="docs-heading-anchor" href="#Domains">Domains</a><a id="Domains-1"></a><a class="docs-heading-anchor-permalink" href="#Domains" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.Domain" href="#PALEOboxes.Domain"><code>PALEOboxes.Domain</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">Domain</code></pre><p>A model region containing Variables and Reactions that act on them.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Domain.jl#L2-L6">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.set_data_dimension!" href="#PALEOboxes.set_data_dimension!"><code>PALEOboxes.set_data_dimension!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">set_data_dimension!(domain::Domain, dim::NamedDimension; allow_exists=false)</code></pre><p>Define a Domain data dimension.</p><p>Variable data dimensions are then defined as Tuples of <code>dim.name</code>s using the <code>:data_dims</code> Attribute.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Domain.jl#L18-L24">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.get_variable" href="#PALEOboxes.get_variable"><code>PALEOboxes.get_variable</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">get_variable(obj, varname, ...) -&gt; variable</code></pre><p>Get <code>variable &lt;: VariableBase</code> by name from PALEO object</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Types.jl#L73-L77">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.get_variables" href="#PALEOboxes.get_variables"><code>PALEOboxes.get_variables</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">get_variables(va::AbstractVarList) -&gt; Vector{VariableReaction}</code></pre><p>Return VariableReaction in <code>va</code> as a flat Vector.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/VariableReaction.jl#L294-L298">source</a></section><section><div><pre><code class="nohighlight hljs">get_variables(domain; hostdep=nothing, vfunction=VF_Undefined) -&gt; Vector{VariableDomain}</code></pre><p>Get domain variables, optionally filtering for subsets based on <code>hostdep</code> and <code>:vfunction</code> attribute</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Domain.jl#L67-L71">source</a></section><section><div><pre><code class="nohighlight hljs">get_variables(domain, filter) -&gt; Vector{VariableDomain}</code></pre><p>Get subset of domain variables where <code>filter(var) == true</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Domain.jl#L86-L90">source</a></section><section><div><pre><code class="nohighlight hljs">get_variables(method::AbstractReactionMethod; filterfn = v -&gt; true) -&gt; Vector</code></pre><p>Get VariableReactions from <code>method.vars</code> as a flat Vector, optionally restricting to those that match <code>filterfn</code></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/ReactionMethod.jl#L99-L103">source</a></section><section><div><pre><code class="nohighlight hljs">get_variables(reaction, localname) -&gt; Vector{VariableReaction}
get_variables(reaction; [filterfn=v-&gt;true]) -&gt; Vector{VariableReaction}</code></pre><p>Get matching Variables from all ReactionMethods.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Reaction.jl#L116-L121">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.get_host_variables" href="#PALEOboxes.get_host_variables"><code>PALEOboxes.get_host_variables</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">get_host_variables(domain, vfunction; [match_deriv_suffix=&quot;&quot;] [, operatorID=0] [, exclude_var_nameroots=[]] [, verbose=false]) 
    -&gt; (host_vars, host_deriv_vars)</code></pre><p>Get state Variables with <a href="#PALEOboxes.VariableFunction"><code>VariableFunction</code></a> <code>vfunction</code>, and optionally  corresponding time derivative with <a href="#PALEOboxes.VariableFunction"><code>VariableFunction</code></a> <code>VF_Deriv</code> and name matching hostvarname*&lt;<code>match_deriv_suffix</code>`&gt;.</p><p>Optionally filter by <code>operatorID</code>, omit Variables with name matching <code>exclude_var_nameroots</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Domain.jl#L101-L110">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.get_unallocated_variables" href="#PALEOboxes.get_unallocated_variables"><code>PALEOboxes.get_unallocated_variables</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">get_unallocated_variables(domain, modeldata) -&gt; Vector{VariableDomain}</code></pre><p>Return any unallocated variables (host-dependent variables which have no data pointer set)</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Domain.jl#L226-L230">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.get_reaction-Tuple{PALEOboxes.Domain, String}" href="#PALEOboxes.get_reaction-Tuple{PALEOboxes.Domain, String}"><code>PALEOboxes.get_reaction</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">get_reaction(domain, reactname) -&gt; Reaction or nothing</code></pre><p>Get a reaction by name.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Domain.jl#L156-L160">source</a></section></article><h3 id="Grids"><a class="docs-heading-anchor" href="#Grids">Grids</a><a id="Grids-1"></a><a class="docs-heading-anchor-permalink" href="#Grids" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.AbstractMesh" href="#PALEOboxes.AbstractMesh"><code>PALEOboxes.AbstractMesh</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">AbstractMesh</code></pre><p>Defines additional geometric and topological information for <a href="#PALEOboxes.Domain"><code>Domain</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Types.jl#L134-L138">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.Grids.UnstructuredVectorGrid" href="#PALEOboxes.Grids.UnstructuredVectorGrid"><code>PALEOboxes.Grids.UnstructuredVectorGrid</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">UnstructuredVectorGrid</code></pre><p>Minimal Grid for a Vector Domain, defines only some named cells for plotting</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Grids.jl#L176-L180">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.Grids.UnstructuredColumnGrid" href="#PALEOboxes.Grids.UnstructuredColumnGrid"><code>PALEOboxes.Grids.UnstructuredColumnGrid</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">UnstructuredColumnGrid</code></pre><p>Minimal Grid for a Vector Domain composed of columns (not necessarily forming a 2-D array).</p><p><strong>Fields</strong></p><ul><li><code>ncells::Int</code> total number of cells in this Domain</li><li><code>Icolumns::Vector{Vector{Int}}</code>: Icolumns[n] should be the indices of column n, in order from surface to floor, where n is also the index of </li></ul><p>any associated boundary surface.</p><ul><li><code>z_coords::Vector{FixedCoord}</code>: z coordinates of cell mid point, lower surface, upper surface</li><li><code>columnnames::Vector{Symbol}:</code> optional column names</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Grids.jl#L233-L244">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.Grids.CartesianLinearGrid" href="#PALEOboxes.Grids.CartesianLinearGrid"><code>PALEOboxes.Grids.CartesianLinearGrid</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">CartesianLinearGrid</code></pre><p>nD grid with netcdf CF1.0 coordinates, using Vectors for PALEO internal representation of Variables, with a mapping linear indices &lt;–&gt; some subset of grid indices.</p><p>The linear indices mapping should be set with <code>set_linear_index</code>. Conversion of Field values between the PALEO internal representation (a Vector with a linear index) and a Cartesian Array with multiple dimensions (for import and export of model output) is then implemented by <code>cartesian_to_internal</code> and <code>internal_to_cartesian</code>.</p><p><strong>Fields</strong></p><ul><li><code>ncells::Int64</code>: number of cells in Domain = <code>length(linear_index)</code> (may be subset of total points in <code>prod(dims)</code>)</li><li><code>dimnames::Vector{String}</code>: names of dimensions (ordered list)</li><li><code>dims::Vector{Int}</code>: sizes of dimensions (ordered list)</li><li><code>coords::Vector{Vector{Float64}}</code>: attached cell-centre coordinates for each dimension (ordered list)</li><li><code>coords_edges::Vector{Vector{Float64}}</code>: attached cell-edge coordinates for each dimension (ordered list)</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Grids.jl#L324-L340">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.Grids.CartesianArrayGrid" href="#PALEOboxes.Grids.CartesianArrayGrid"><code>PALEOboxes.Grids.CartesianArrayGrid</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">CartesianArrayGrid</code></pre><p>nD grid with netcdf CF1.0 coordinates, using n-dimensional Arrays for PALEO internal representation of Variables</p><p><strong>Fields</strong></p><ul><li><code>ncells::Int64</code>: number of cells in Domain = <code>length(linear_index)</code> (may be subset of total points in <code>prod(dims)</code>)</li><li><code>dimnames::Vector{String}</code>: names of dimensions (ordered list)</li><li><code>dims::Vector{Int}</code>: sizes of dimensions (ordered list)</li><li><code>coords::Vector{Vector{Float64}}</code>: attached cell-centre coordinates for each dimension (ordered list)</li><li><code>coords_edges::Vector{Vector{Float64}}</code>: attached cell-edge coordinates for each dimension (ordered list)</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Grids.jl#L380-L391">source</a></section></article><h3 id="CellRange"><a class="docs-heading-anchor" href="#CellRange">CellRange</a><a id="CellRange-1"></a><a class="docs-heading-anchor-permalink" href="#CellRange" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.AbstractCellRange" href="#PALEOboxes.AbstractCellRange"><code>PALEOboxes.AbstractCellRange</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">AbstractCellRange</code></pre><p>Defines a range of cells within a <a href="#PALEOboxes.Domain"><code>Domain</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Types.jl#L149-L153">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.CellRange" href="#PALEOboxes.CellRange"><code>PALEOboxes.CellRange</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">CellRange</code></pre><p>Defines a range of cells in a specified <a href="#PALEOboxes.Domain"><code>Domain</code></a> as a linear list.</p><p>If <code>operatorID==0</code>, call all <code>Reaction</code>s, otherwise only call those with matching <code>operatorID</code> (this enables operator splitting).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/CellRange.jl#L3-L10">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.CellRangeColumns" href="#PALEOboxes.CellRangeColumns"><code>PALEOboxes.CellRangeColumns</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">CellRangeColumns</code></pre><p>Defines a range of cells in a specified <a href="#PALEOboxes.Domain"><code>Domain</code></a>, organised by columns. If <code>operatorID==0</code>, call all <code>Reaction</code>s, otherwise only call those with matching <code>operatorID</code> (this enables operator splitting).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/CellRange.jl#L30-L36">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.create_default_cellrange" href="#PALEOboxes.create_default_cellrange"><code>PALEOboxes.create_default_cellrange</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">create_default_cellrange(model::Model [; operatorID=0]) -&gt; Vector{AbstractCellRange}</code></pre><p>Create a <code>Vector</code> of <code>CellRange</code> instances covering the entire model.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Model.jl#L332-L336">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.Grids.create_default_cellrange" href="#PALEOboxes.Grids.create_default_cellrange"><code>PALEOboxes.Grids.create_default_cellrange</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">create_default_cellrange(domain, grid, [; operatorID=0]) -&gt; CellRange</code></pre><p>Create a CellRange for entire <code>domain</code> and supplied <code>operatorID</code></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Grids.jl#L113-L117">source</a></section><section><div><pre><code class="nohighlight hljs">create_default_cellrange(domain, grid::Nothing [; operatorID=0]) -&gt; CellRange</code></pre><p>Create a CellRange for entire <code>domain</code>. Fallback for a domain with no grid</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Grids.jl#L156-L160">source</a></section><section><div><pre><code class="nohighlight hljs">create_default_cellrange(domain, grid::UnstructuredVectorGrid [; operatorID=0]) -&gt; CellRange</code></pre><p>Create a CellRange for entire <code>domain</code> - use linear index.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Grids.jl#L220-L224">source</a></section><section><div><pre><code class="nohighlight hljs">create_default_cellrange(domain, grid::UnstructuredColumnGrid [; operatorID=0]) -&gt; CellRangeColumns</code></pre><p>Create a CellRange for entire <code>domain</code>. Return a <a href="#PALEOboxes.CellRangeColumns"><code>PB.CellRangeColumns</code></a> with iterators for columns and cells.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Grids.jl#L303-L307">source</a></section><section><div><pre><code class="nohighlight hljs">create_default_cellrange(domain, grid::Union{CartesianLinearGrid, CartesianArrayGrid} [; operatorID=0]) -&gt; CellRangeColumns</code></pre><p>Create a CellRange for entire <code>domain</code>. Return a <a href="#PALEOboxes.CellRangeColumns"><code>PB.CellRangeColumns</code></a> provided by <a href="#PALEOboxes.Grids.cellrange_cartesiantile"><code>cellrange_cartesiantile</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Grids.jl#L826-L830">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.Grids.cellrange_cartesiantile" href="#PALEOboxes.Grids.cellrange_cartesiantile"><code>PALEOboxes.Grids.cellrange_cartesiantile</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">cellrange_cartesiantile</code></pre><p>Create a range of cells within a region of CartesianLinearGrid specified by <code>rangestuple</code> in a specified <a href="#PALEOboxes.Domain"><code>PB.Domain</code></a></p><p><code>rangestuple</code> is a tuple of Cartesian index ranges eg (1:9, :, :) for a 3D grid.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Grids.jl#L749-L755">source</a></section><section><div><p>3D case return a CellRangeColumns</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Grids.jl#L770">source</a></section><section><div><p>return partitioning of a 3D Domain into n tiles</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Grids.jl#L849">source</a></section></article><h3 id="Subdomains"><a class="docs-heading-anchor" href="#Subdomains">Subdomains</a><a id="Subdomains-1"></a><a class="docs-heading-anchor-permalink" href="#Subdomains" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.AbstractSubdomain" href="#PALEOboxes.AbstractSubdomain"><code>PALEOboxes.AbstractSubdomain</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">AbstractSubdomain</code></pre><p>Defines relationship between two <a href="#PALEOboxes.Domain"><code>Domain</code></a> by mapping indices in one Domain to related indices in the other, eg interior cells adjacent to a boundary.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Types.jl#L124-L129">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.Grids.BoundarySubdomain" href="#PALEOboxes.Grids.BoundarySubdomain"><code>PALEOboxes.Grids.BoundarySubdomain</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">BoundarySubdomain</code></pre><p>A 2D subdomain corresponding to the 2D boundary Domain associated with a 3D interior Domain:</p><ul><li><code>indices[ibnd]</code> is the index of the 3D interior cell corresponding to a 2D boundary cell <code>ibnd</code>.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Grids.jl#L12-L17">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.Grids.InteriorSubdomain" href="#PALEOboxes.Grids.InteriorSubdomain"><code>PALEOboxes.Grids.InteriorSubdomain</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">InteriorSubdomain</code></pre><p>A 3D subdomain corresponding to the 3D interior Domain associated with a 2D boundary Domain: <code>indices[iint]</code> is either:</p><ul><li><code>missing</code> if <code>iint</code> is the index of an interior cell in the 3D Domain, or</li><li>the index of the 2D boundary Domain cell corresponding to the boundary-adjacent 3D interior Domain cell <code>iint</code></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Grids.jl#L42-L48">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.Grids.set_subdomain!" href="#PALEOboxes.Grids.set_subdomain!"><code>PALEOboxes.Grids.set_subdomain!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">set_subdomain!(grid::PB.AbstractMesh, subdomainname::AbstractString, subdom::PB.AbstractSubdomain, allowcreate::Bool=false)</code></pre><p>Set Subdomain</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Grids.jl#L128-L132">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.Grids.subdomain_view" href="#PALEOboxes.Grids.subdomain_view"><code>PALEOboxes.Grids.subdomain_view</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">subdomain_view(values, subdomain::BoundarySubdomain) -&gt; view</code></pre><p>Create a <code>view</code> on <code>values</code> in an interior <code>Domain</code> to access cells corresponding to indices in a boundary <code>Domain</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Grids.jl#L22-L27">source</a></section><section><div><pre><code class="nohighlight hljs">subdomain_view(values, subdomain::InteriorSubdomain) -&gt; var</code></pre><p>Return unmodified <code>values</code> from a boundary <code>Domain</code>, <code>indices</code> to access  from interior supplied by <a href="#PALEOboxes.Grids.subdomain_indices"><code>subdomain_indices</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Grids.jl#L64-L69">source</a></section><section><div><p>fallback when <code>subdomain == nothing</code></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Grids.jl#L88">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.Grids.subdomain_indices" href="#PALEOboxes.Grids.subdomain_indices"><code>PALEOboxes.Grids.subdomain_indices</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">subdomain_indices(subdomain::BoundarySubdomain) -&gt; nothing</code></pre><p>No additional indices required to access Variables in an interior <code>Domain</code> from a boundary <code>Domain</code> (view created by <a href="#PALEOboxes.Grids.subdomain_view"><code>subdomain_view</code></a> is sufficient).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Grids.jl#L32-L37">source</a></section><section><div><pre><code class="nohighlight hljs">subdomain_indices(subdomain::InteriorSubdomain) -&gt; indices</code></pre><p>Return <code>indices</code> to access Variables in a boundary <code>Domain</code> from interior <code>Domain</code> (will have <code>missing</code> entries where interior cells do not correspond to boundary)</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Grids.jl#L74-L79">source</a></section><section><div><p>fallback when <code>subdomain == nothing</code></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Grids.jl#L93">source</a></section></article><h2 id="Variables"><a class="docs-heading-anchor" href="#Variables">Variables</a><a id="Variables-1"></a><a class="docs-heading-anchor-permalink" href="#Variables" title="Permalink"></a></h2><p>PALEO <code>Variables</code> exist in <a href="#PALEOboxes.Domain"><code>Domain</code></a>s and represent biogeochemical or other quantities. They are defined by <code>Reactions</code> as <a href="#PALEOboxes.VariableReaction"><code>VariableReaction</code></a>s which are then linked to create <a href="#PALEOboxes.VariableDomain"><code>VariableDomain</code></a>s, and contain <a href="#PALEOboxes.Field"><code>Field</code></a>s which represent data (a subtype of <a href="#PALEOboxes.AbstractData"><code>AbstractData</code></a>) in a function space (a subtype of <a href="#PALEOboxes.AbstractSpace"><code>AbstractSpace</code></a>) with dimensions defined by the Domain grid (a subtype of <a href="#PALEOboxes.AbstractMesh"><code>AbstractMesh</code></a>)</p><p>Dataflow dependency between <code>Variables</code> is represented by two pairings:</p><ul><li><a href="#PALEOboxes.VariableReaction"><code>VariableReaction</code></a>s of <a href="#PALEOboxes.VariableType"><code>VariableType</code></a> <code>VT_ReactProperty</code> and <code>VT_ReactDependency</code> which are linked to create <a href="#PALEOboxes.VariableDomPropDep"><code>VariableDomPropDep</code></a>s</li><li><a href="#PALEOboxes.VariableReaction"><code>VariableReaction</code></a>s of <a href="#PALEOboxes.VariableType"><code>VariableType</code></a> <code>VT_ReactTarget</code> and <code>VT_ReactContributor</code> which are linked to create  <a href="#PALEOboxes.VariableDomContribTarget"><code>VariableDomContribTarget</code></a>s.</li></ul><p>Field, data and function space are defined by Variable <a href="#PALEOboxes.Attribute"><code>Attribute</code></a>s in combination with an <a href="#PALEOboxes.AbstractMesh"><code>AbstractMesh</code></a></p><ul><li><code>:field_data</code> and optionally <code>:data_dims</code> define the subtype of <a href="#PALEOboxes.AbstractData"><code>AbstractData</code></a></li><li><code>:space</code> defines the subtype of <a href="#PALEOboxes.AbstractSpace"><code>AbstractSpace</code></a></li></ul><p>Examples:</p><ul><li><code>:field_data</code> = <a href="#PALEOboxes.ScalarData"><code>ScalarData</code></a>, <code>:space</code> = <a href="#PALEOboxes.ScalarSpace"><code>ScalarSpace</code></a> defines a Domain scalar (0D) quantity.</li><li><code>:field_data</code> = <a href="#PALEOboxes.IsotopeLinear"><code>IsotopeLinear</code></a>, <code>:space</code> = <a href="#PALEOboxes.ScalarSpace"><code>ScalarSpace</code></a> defines a Domain scalar (0D) isotope quantity.</li><li><code>:field_data</code> = <a href="#PALEOboxes.ScalarData"><code>ScalarData</code></a>, <code>:space</code> = <a href="#PALEOboxes.CellSpace"><code>CellSpace</code></a> defines a per-cell quantity in a spatial Domain.</li><li><code>:field_data</code> = <a href="#PALEOboxes.ArrayScalarData"><code>ArrayScalarData</code></a>, <code>:data_dims =(&quot;wgrid&quot;,)</code> <code>:space</code> = <a href="#PALEOboxes.ScalarSpace"><code>ScalarSpace</code></a> defines a Domain scalar (0D) quantity on a wavelength grid, a Vector of length given by the value of the Domain &quot;wgrid&quot; data dimension (see <a href="#PALEOboxes.set_data_dimension!"><code>set_data_dimension!</code></a>)</li></ul><p><a href="#PALEOboxes.FieldArray"><code>FieldArray</code></a> provides a generic array type with named dimensions <a href="#PALEOboxes.NamedDimension"><code>NamedDimension</code></a>s and optional coordinates <a href="#PALEOboxes.FixedCoord"><code>FixedCoord</code></a> for processing of model output.</p><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.VariableBase" href="#PALEOboxes.VariableBase"><code>PALEOboxes.VariableBase</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">VariableBase</code></pre><p>A <code>Model</code> biogeochemical <code>Variable</code>. <code>Reaction</code>s access <code>Variable</code>s using derived Types <a href="#PALEOboxes.VariableReaction"><code>VariableReaction</code></a> which are links to <a href="#PALEOboxes.VariableDomain"><code>VariableDomain</code></a>s.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Types.jl#L57-L62">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.VariableType" href="#PALEOboxes.VariableType"><code>PALEOboxes.VariableType</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">@enum VariableType</code></pre><p>Enumeration of <code>VariableBase</code> subtypes. Allowed values:</p><ul><li><code>VariableReaction</code>: <code>VT_ReactProperty</code>, <code>VT_ReactDependency</code>, <code>VT_ReactContributor</code>, <code>VT_ReactTarget</code></li><li><code>VariableDomain</code> : <code>VT_DomPropDep</code>, <code>VT_DomContribTarget</code></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Types.jl#L88-L94">source</a></section></article><p>TODO standard Variable names.</p><p>Use NetCDF CF standard names <a href="https://cfconventions.org/Data/cf-standard-names/76/build/cf-standard-name-table.html">https://cfconventions.org/Data/cf-standard-names/76/build/cf-standard-name-table.html</a> ?</p><h3 id="Data-types"><a class="docs-heading-anchor" href="#Data-types">Data types</a><a id="Data-types-1"></a><a class="docs-heading-anchor-permalink" href="#Data-types" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.AbstractData" href="#PALEOboxes.AbstractData"><code>PALEOboxes.AbstractData</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">AbstractData</code></pre><p>Defines a Data type that can be composed with a Space to form a Field</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Types.jl#L165-L169">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.UndefinedData" href="#PALEOboxes.UndefinedData"><code>PALEOboxes.UndefinedData</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">UndefinedData</code></pre><p>Undefined data type (no methods implemented). Used to indicate that a Variable can link to any data type.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Fields.jl#L293-L297">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.ScalarData" href="#PALEOboxes.ScalarData"><code>PALEOboxes.ScalarData</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">ScalarData</code></pre><p>A Field scalar (eg a biogeochemical concentration)</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/ScalarData.jl#L7-L11">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.ArrayScalarData" href="#PALEOboxes.ArrayScalarData"><code>PALEOboxes.ArrayScalarData</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">ArrayScalarData</code></pre><p>An Array of Field scalars (eg a intensity on a wavelength grid).</p><p>NB: only implements minimal methods sufficient to allow use as a model internal variable, not as a state variable.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/ArrayScalarData.jl#L5-L11">source</a></section></article><h4 id="Isotopes"><a class="docs-heading-anchor" href="#Isotopes">Isotopes</a><a id="Isotopes-1"></a><a class="docs-heading-anchor-permalink" href="#Isotopes" title="Permalink"></a></h4><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.AbstractIsotopeScalar" href="#PALEOboxes.AbstractIsotopeScalar"><code>PALEOboxes.AbstractIsotopeScalar</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">AbstractIsotopeScalar</code></pre><p>An IsotopeScalar represents a quantity or flux with isotopic composition. Can be added, subtracted, multiplied by a scalar, and decomposed into components with the same (bulk) transport properties.</p><p><strong>Implementation</strong></p><p>Each IsotopeScalar should be added to <code>IsotopeTypes</code>, and implement:</p><ul><li>get_total(is::IsotopeScalar) -&gt; total</li><li>arithmetic operations +/- (ie IsotopeScalars can be added and subtracted) and *number, /number  (IsotopeScalars can be scaled by a real number).</li><li>methods of the <a href="#PALEOboxes.AbstractData"><code>AbstractData</code></a> interface</li></ul><p>and optional isotope-specific functions, eg for a single isotope:</p><ul><li>isotope_totaldelta(::Type{&lt;: IsotopeScalar}, total, delta) -&gt; IsotopeScalar()</li><li>get_delta(is::IsotopeScalar) -&gt; delta</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/IsotopeData.jl#L9-L27">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.IsotopeLinear" href="#PALEOboxes.IsotopeLinear"><code>PALEOboxes.IsotopeLinear</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">IsotopeLinear</code></pre><p>Linearized representation of isotopic composition, where  <code>moldelta</code> = <code>total</code> * <code>delta</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/IsotopeData.jl#L92-L97">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.isotope_totaldelta" href="#PALEOboxes.isotope_totaldelta"><code>PALEOboxes.isotope_totaldelta</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">isotope_totaldelta(::Type{IsotopeLinear}, total, delta) -&gt; IsotopeLinear</code></pre><p>Create an <code>IsotopeLinear</code> from <code>total</code> and <code>delta</code></p><p><strong>Examples:</strong></p><pre><code class="language-julia-repl hljs">julia&gt; a = PB.isotope_totaldelta(PB.IsotopeLinear, 10.0, -2.0)
(v=10.0, v_moldelta=-20.0, ‰=-2.0)

julia&gt; b = a*2
(v=20.0, v_moldelta=-40.0, ‰=-2.0)

julia&gt; c = a + b
(v=30.0, v_moldelta=-60.0, ‰=-2.0)

julia&gt; PB.get_total(c)
30.0

julia&gt; PB.get_delta(c)
-2.0</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/IsotopeData.jl#L121-L143">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.get_total" href="#PALEOboxes.get_total"><code>PALEOboxes.get_total</code></a> — <span class="docstring-category">Function</span></header><section><div><p>generic get_total for non-isotope variable</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/IsotopeData.jl#L51">source</a></section><section><div><pre><code class="nohighlight hljs">get_total(is::IsotopeLinear) -&gt; T</code></pre><p>Get isotope delta (per mil)</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/IsotopeData.jl#L147-L151">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.get_delta" href="#PALEOboxes.get_delta"><code>PALEOboxes.get_delta</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">get_delta(is::IsotopeLinear) -&gt; T</code></pre><p>Get isotope delta (per mil)</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/IsotopeData.jl#L156-L160">source</a></section></article><h3 id="Spaces"><a class="docs-heading-anchor" href="#Spaces">Spaces</a><a id="Spaces-1"></a><a class="docs-heading-anchor-permalink" href="#Spaces" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.AbstractSpace" href="#PALEOboxes.AbstractSpace"><code>PALEOboxes.AbstractSpace</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">AbstractSpace</code></pre><p>Defines a function space within a Domain, on a mesh defined by a Grid </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Types.jl#L157-L161">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.ScalarSpace" href="#PALEOboxes.ScalarSpace"><code>PALEOboxes.ScalarSpace</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">ScalarSpace</code></pre><p>A Domain position-independent quantity</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Fields.jl#L7-L11">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.CellSpace" href="#PALEOboxes.CellSpace"><code>PALEOboxes.CellSpace</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">CellSpace</code></pre><p>A per-cell quantity. Use as Variable attribute :space to create a Variable with data array dimensions from Grid</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Fields.jl#L15-L19">source</a></section></article><h3 id="Fields"><a class="docs-heading-anchor" href="#Fields">Fields</a><a id="Fields-1"></a><a class="docs-heading-anchor-permalink" href="#Fields" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.Field" href="#PALEOboxes.Field"><code>PALEOboxes.Field</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">Field{D &lt;: AbstractData, S &lt;: AbstractSpace, V, N, M}</code></pre><p>A Field of data type <code>D</code> defined on function space <code>S</code> over <code>mesh</code> and (optionally) <code>data_dims</code></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Fields.jl#L307-L311">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.FieldRecord" href="#PALEOboxes.FieldRecord"><code>PALEOboxes.FieldRecord</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">FieldRecord{D &lt;: AbstractData, S &lt;: AbstractSpace, ...}</code></pre><p>A series of records each containing a <a href="#PALEOboxes.Field"><code>Field</code></a>.</p><p><strong>Implementation</strong></p><p>Fields with array values are stored in <code>records</code> as a Vector of arrays. Fields with single values (field<em>single</em>element true) are stored as a Vector of eltype(Field.values). </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Fields.jl#L508-L516">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.get_field" href="#PALEOboxes.get_field"><code>PALEOboxes.get_field</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">get_field(obj, ...) -&gt; Field</code></pre><p>Get Field or FieldRecord from PALEO object <code>obj</code></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Fields.jl#L318-L322">source</a></section></article><h3 id="FieldArray"><a class="docs-heading-anchor" href="#FieldArray">FieldArray</a><a id="FieldArray-1"></a><a class="docs-heading-anchor-permalink" href="#FieldArray" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.FieldArray" href="#PALEOboxes.FieldArray"><code>PALEOboxes.FieldArray</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">FieldArray</code></pre><p>A generic <a href="https://xarray.pydata.org/en/stable/index.html">xarray</a>-like or  <a href="https://scitools-iris.readthedocs.io/en/latest/">IRIS</a>-like  Array with named dimensions and optional coordinates.</p><p>NB: this aims to be simple and generic, not efficient !!! Intended for representing model output, not for numerically-intensive calculations.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/CoordsDimsFieldArray.jl#L207-L216">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.get_array" href="#PALEOboxes.get_array"><code>PALEOboxes.get_array</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">get_array(obj, ...) -&gt; FieldArray</code></pre><p>Get FieldArray from PALEO object <code>obj</code></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/CoordsDimsFieldArray.jl#L225-L229">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.FixedCoord" href="#PALEOboxes.FixedCoord"><code>PALEOboxes.FixedCoord</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">FixedCoord</code></pre><p>A fixed (state independent) coordinate</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/CoordsDimsFieldArray.jl#L6-L10">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.NamedDimension" href="#PALEOboxes.NamedDimension"><code>PALEOboxes.NamedDimension</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">NamedDimension</code></pre><p>A named dimension, with optional attached fixed coordinates <code>coords</code></p><p>PALEO convention is that where possible <code>coords</code> contains three elements, for cell midpoints, lower edges, upper edges, in that order.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/CoordsDimsFieldArray.jl#L119-L126">source</a></section></article><h3 id="Variable-Attributes"><a class="docs-heading-anchor" href="#Variable-Attributes">Variable Attributes</a><a id="Variable-Attributes-1"></a><a class="docs-heading-anchor-permalink" href="#Variable-Attributes" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.Attribute" href="#PALEOboxes.Attribute"><code>PALEOboxes.Attribute</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">Attribute{T}</code></pre><p>Definition for Variable attribute <code>name</code>. Defines a data type <code>T</code>, a <code>default_value</code>, <code>required</code> (<code>true</code> if always present ie added with <code>default_value</code> when Variable is created), <code>units</code>, and an optional <code>description</code>.</p><p>Note that Variable attributes are stored as a per-Variable <code>Dict(name =&gt; value)</code>, these definitions are only used to provide defaults, check types, and provide descriptive metadata.</p><p><code>ParseFromString</code> should usually be <code>false</code>: a value of <code>Type T</code> is then required when calling <a href="#PALEOboxes.set_attribute!"><code>set_attribute!</code></a>. If <code>ParseFromString</code> is <code>true</code>, then <a href="#PALEOboxes.set_attribute!"><code>set_attribute!</code></a> will accept an <code>AbstractString</code> and call <code>Base.parse(T, strvalue)</code> to convert to <code>T</code>. This allows eg an enum-valued Attribute to be defined by Attribute{EnumType, true} and implementing parse(EnumType, rawvalue::AbstractString)</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/VariableAttributes.jl#L97-L110">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.StandardAttributes" href="#PALEOboxes.StandardAttributes"><code>PALEOboxes.StandardAttributes</code></a> — <span class="docstring-category">Constant</span></header><section><div><pre><code class="language-julia hljs">StandardAttributes</code></pre><p>List of standard Variable attributes.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/VariableAttributes.jl#L121-L125">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.get_attribute" href="#PALEOboxes.get_attribute"><code>PALEOboxes.get_attribute</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">get_attribute(var::VariableBase, name::Symbol, missing_value=missing) -&gt; value</code></pre><p>Get Variable attribute.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/VariableAttributes.jl#L23-L27">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.num_components" href="#PALEOboxes.num_components"><code>PALEOboxes.num_components</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">num_components(field_data::Type{&lt;:AbstractData}) -&gt; Int</code></pre><p>get number of components (optional - implement if <code>field_data</code> has a representation as components)</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Fields.jl#L267-L271">source</a></section><section><div><pre><code class="nohighlight hljs">num_components(var::VariableBase) -&gt; Int</code></pre><p>Number of components in <code>var</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/VariableAttributes.jl#L32-L36">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.VariableFunction" href="#PALEOboxes.VariableFunction"><code>PALEOboxes.VariableFunction</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">@enum VariableFunction</code></pre><p>Allowed values of <code>:vfunction</code> Variable <a href="#PALEOboxes.Attribute"><code>Attribute</code></a>,  defining the Variable function to the host ODE or DAE solver.</p><p>Explicit ODE problems with dS/dt = F(S) consist of pairs of S::VF<em>StateExplicit, F::VF</em>Deriv Variables.</p><p>An implicit ODE problem with dU/dt = F(U) where Total variables U are functions U(S) of State variables S will consist of pairs of U::VF<em>Total and F::VF</em>Deriv Variables, and also the same number of S::VF_State (in  no particular order).</p><p>Algebraic constraints  C(S) = 0 include variables C::VF<em>Constraint and the same number of S::VF</em>State, with no corresponding VF_Deriv.</p><p>Not all solvers support all combinations.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/VariableAttributes.jl#L44-L60">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.VariablePhase" href="#PALEOboxes.VariablePhase"><code>PALEOboxes.VariablePhase</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">@enum VariablePhase</code></pre><p>Allowed values of <code>:vphase</code> Variable <a href="#PALEOboxes.Attribute"><code>Attribute</code></a>, defining the component phase this Variable belongs to  for multiphase cells.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/VariableAttributes.jl#L76-L81">source</a></section></article><h3 id="VariableDomain"><a class="docs-heading-anchor" href="#VariableDomain">VariableDomain</a><a id="VariableDomain-1"></a><a class="docs-heading-anchor-permalink" href="#VariableDomain" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.VariableDomain" href="#PALEOboxes.VariableDomain"><code>PALEOboxes.VariableDomain</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">VariableDomain</code></pre><p>Host (<a href="#PALEOboxes.Domain"><code>Domain</code></a>) model variable.</p><p>See also: <a href="#PALEOboxes.VariableDomPropDep"><code>VariableDomPropDep</code></a>, <a href="#PALEOboxes.VariableDomContribTarget"><code>VariableDomContribTarget</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Types.jl#L105-L111">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.VariableDomPropDep" href="#PALEOboxes.VariableDomPropDep"><code>PALEOboxes.VariableDomPropDep</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">VariableDomPropDep</code></pre><p><a href="#PALEOboxes.Model"><code>Model</code></a> (<a href="#PALEOboxes.Domain"><code>Domain</code></a>) <code>VariableDomain</code> linking a single <code>VariableReaction{VT_ReactProperty}</code> to multiple <code>VariableReaction{VT_ReactDependency}</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/VariableDomain.jl#L1-L6">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.VariableDomContribTarget" href="#PALEOboxes.VariableDomContribTarget"><code>PALEOboxes.VariableDomContribTarget</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">VariableDomContribTarget</code></pre><p><a href="#PALEOboxes.Model"><code>Model</code></a> (<a href="#PALEOboxes.Domain"><code>Domain</code></a>) <code>VariableDomain</code> linking a single <code>VariableReaction{VT_ReactTarget}</code> to multiple <code>VariableReaction{VT_ReactContributor}</code> and <code>VariableReaction{VT_ReactDependency}</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/VariableDomain.jl#L22-L27">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.set_data!" href="#PALEOboxes.set_data!"><code>PALEOboxes.set_data!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">set_data!(var, modeldata, data)</code></pre><p>Set <code>VariableDomain</code> to a Field wrapping <code>data</code></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/VariableDomain.jl#L59-L63">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.get_data" href="#PALEOboxes.get_data"><code>PALEOboxes.get_data</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">get_data(var::VariableDomain, modelordomaindata) -&gt; field.values</code></pre><p>Get Variable <code>var</code> data array</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/VariableDomain.jl#L95-L99">source</a></section><section><div><p>va -&gt; x</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/VariableAggregator.jl#L142">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.get_data_output" href="#PALEOboxes.get_data_output"><code>PALEOboxes.get_data_output</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">get_data_output(var, modelordomaindata) -&gt; Field.values</code></pre><p>Get a sanitized version of Variable <code>var</code> data array for storing as output</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/VariableDomain.jl#L102-L106">source</a></section></article><h2 id="Reactions"><a class="docs-heading-anchor" href="#Reactions">Reactions</a><a id="Reactions-1"></a><a class="docs-heading-anchor-permalink" href="#Reactions" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.AbstractReaction" href="#PALEOboxes.AbstractReaction"><code>PALEOboxes.AbstractReaction</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">AbstractReaction</code></pre><p>Base Type for Reactions.</p><p><strong>Implementation</strong></p><p>Derived types should include a field <code>base::</code><a href="#PALEOboxes.ReactionBase"><code>ReactionBase</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Types.jl#L41-L48">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.ReactionBase" href="#PALEOboxes.ReactionBase"><code>PALEOboxes.ReactionBase</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">ReactionBase</code></pre><p>Base Type for a biogeochemical Reaction.</p><p><strong>Implementation</strong></p><p>Include as field <code>base</code> in types derived from <a href="#PALEOboxes.AbstractReaction"><code>AbstractReaction</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Reaction.jl#L3-L10">source</a></section></article><h3 id="Registering-with-PALEOboxes-framework"><a class="docs-heading-anchor" href="#Registering-with-PALEOboxes-framework">Registering with PALEOboxes framework</a><a id="Registering-with-PALEOboxes-framework-1"></a><a class="docs-heading-anchor-permalink" href="#Registering-with-PALEOboxes-framework" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.reaction_factories" href="#PALEOboxes.reaction_factories"><code>PALEOboxes.reaction_factories</code></a> — <span class="docstring-category">Constant</span></header><section><div><pre><code class="language-julia hljs">const reaction_factories = Dict{classname::String, Function}()</code></pre><p>Dictionary of reaction factories.</p><p>A module containing Reactions should define a module <code>__init__()</code> function that includes a call to [<code>add_reaction_factory</code>] for each Reaction. This registers functions that then return instances of the Reaction structs.</p><pre><code class="nohighlight hljs">&quot;Install create_reactionXXX factories when module imported&quot;
function __init__()
    PB.add_reaction_factory(ReactionReservoirScalar)
end</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/ReactionFactory.jl#L3-L16">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.add_reaction_factory" href="#PALEOboxes.add_reaction_factory"><code>PALEOboxes.add_reaction_factory</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">add_reaction_factory(ReactionType::Type{&lt;:AbstractReaction}; [, operatorID=[1]] [, set_pars::Tuple])
add_reaction_factory(classname, ReactionType::Type{&lt;:AbstractReaction}; [, operatorID=[1]] [, set_pars::Tuple])
add_reaction_factory(classname, factory_fn)</code></pre><p>Register a ReactionType to be created either by using the default <a href="#PALEOboxes.reaction_factory"><code>reaction_factory</code></a> and typename as classname, or by the explicitly supplied <code>factory_fn</code> and <code>classname</code>.</p><p>Optionally, after creation, set and freeze Parameters in <code>set_pars</code> (a Tuple of Pairs of name=&gt;value eg (&quot;total&quot;=&gt;false,) )</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/ReactionFactory.jl#L60-L69">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.reaction_factory" href="#PALEOboxes.reaction_factory"><code>PALEOboxes.reaction_factory</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">reaction_factory(ReactionType::Type{&lt;:AbstractReaction}; [, operatorID=[1]] [,extra_par_fields], [, set_pars::Tuple]) -&gt; Function</code></pre><p>Return a function that will create Reaction of type <code>rt</code> when called.</p><p>Optionally, after creation, set and freeze Parameters in <code>set_pars</code> (a Tuple of Pairs of name=&gt;value eg (&quot;total&quot;=&gt;false,) )</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/ReactionFactory.jl#L19-L25">source</a></section></article><h3 id="Parameters"><a class="docs-heading-anchor" href="#Parameters">Parameters</a><a id="Parameters-1"></a><a class="docs-heading-anchor-permalink" href="#Parameters" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.AbstractParameter" href="#PALEOboxes.AbstractParameter"><code>PALEOboxes.AbstractParameter</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">AbstractParameter</code></pre><p>Base Type for Parameters</p><p>See also: <a href="#PALEOboxes.Parameter"><code>Parameter</code></a>, <a href="#PALEOboxes.VecParameter"><code>VecParameter</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Types.jl#L16-L22">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.Parameter" href="#PALEOboxes.Parameter"><code>PALEOboxes.Parameter</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">Parameter{T, ParseFromString}</code></pre><p>A reaction parameter of type <code>T</code> Create using short names <code>ParDouble</code>, <code>ParInt</code>, <code>ParBool</code>, <code>ParString</code>. Value is <code>&lt;par&gt;.v::T</code>.</p><p><code>ParseFromString</code> should usually be <code>false</code>: a value of <code>Type T</code> is then required when calling <a href="#PALEOboxes.setvalue!"><code>setvalue!</code></a>. If <code>ParseFromString</code> is not Nothing, then <a href="#PALEOboxes.setvalue!"><code>setvalue!</code></a> will accept an <code>AbstractString</code> and call <code>Base.parse(ParseFromString, strvalue)</code>. This allows eg an enum-valued Parameter to be defined by Parameter{EnumType, EnumType} and implementing parse(EnumType, rawvalue::AbstractString)</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Parameter.jl#L4-L15">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.VecParameter" href="#PALEOboxes.VecParameter"><code>PALEOboxes.VecParameter</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">VecParameter{T, ParseFromString}</code></pre><p>A reaction parameter of type Vector{T}. Create using short names <code>ParDoubleVec</code>, <code>ParStringVec</code>. Values are <code>&lt;par&gt;.v::Vector{T}</code>. Set using standard yaml syntax for a vector eg [1, 2, 3]</p><p><code>ParseFromString</code> should usually be <code>false</code> (see <a href="#PALEOboxes.Parameter"><code>Parameter</code></a>).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Parameter.jl#L110-L119">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.VecVecParameter" href="#PALEOboxes.VecVecParameter"><code>PALEOboxes.VecVecParameter</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">VecVecParameter{T, ParseFromString}</code></pre><p>A reaction parameter of type Vector{Vector{T}}. Create using short names <code>ParDoubleVecVec</code>. Values are <code>&lt;par&gt;.v::Vector{Vector{T}}</code>. Set using standard yaml syntax for a vector of vectors eg [[1, 2, 3], [4, 5, 6]]</p><p><code>ParseFromString</code> should usually be <code>false</code> (see <a href="#PALEOboxes.Parameter"><code>Parameter</code></a>).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Parameter.jl#L184-L193">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.ParametersTuple" href="#PALEOboxes.ParametersTuple"><code>PALEOboxes.ParametersTuple</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">ParametersTuple(parameters::AbstractParameter...) -&gt; NamedTuple
ParametersTuple(parameters) -&gt; NamedTuple</code></pre><p>Create a NamedTuple of Parameters.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Parameter.jl#L432-L437">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.add_par" href="#PALEOboxes.add_par"><code>PALEOboxes.add_par</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">add_par(reaction::AbstractReaction, par::AbstractParameter)
add_par(reaction::AbstractReaction, objectwithpars)</code></pre><p>Add a single parameter or parameters from fields of <code>objectwithpars</code> to a new Reaction.</p><p>Not usually needed: <a href="#PALEOboxes.add_reaction_factory"><code>add_reaction_factory</code></a> will provide a <a href="#PALEOboxes.reaction_factory"><code>reaction_factory</code></a> that does this automatically for Parameters in pars::ParametersTuple.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Reaction.jl#L226-L234">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.setvalue!" href="#PALEOboxes.setvalue!"><code>PALEOboxes.setvalue!</code></a> — <span class="docstring-category">Function</span></header><section><div><p>Set Parameter value</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Parameter.jl#L294">source</a></section><section><div><p>Set Parameter value</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Parameter.jl#L309">source</a></section><section><div><p>allow an empty Vector{Any} (as that is what yaml provides for [])</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Parameter.jl#L326">source</a></section></article><h3 id="Initialisation-callbacks"><a class="docs-heading-anchor" href="#Initialisation-callbacks">Initialisation callbacks</a><a id="Initialisation-callbacks-1"></a><a class="docs-heading-anchor-permalink" href="#Initialisation-callbacks" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.set_model_geometry" href="#PALEOboxes.set_model_geometry"><code>PALEOboxes.set_model_geometry</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">set_model_geometry(reaction, model)</code></pre><p>Optional: define model <code>Domain</code> size, Subdomains etc (only implemented by Reactions that define grids).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Reaction.jl#L179-L184">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.register_methods!" href="#PALEOboxes.register_methods!"><code>PALEOboxes.register_methods!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">register_methods!(reaction)
register_methods!(reaction, model)</code></pre><p>Add <a href="#PALEOboxes.ReactionMethod"><code>ReactionMethod</code></a>s, using <a href="#PALEOboxes.add_method_setup!"><code>add_method_setup!</code></a>, <a href="#PALEOboxes.add_method_initialize!"><code>add_method_initialize!</code></a> <a href="#PALEOboxes.add_method_do!"><code>add_method_do!</code></a>. See also <a href="#PALEOboxes.register_dynamic_methods!"><code>register_dynamic_methods!</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Reaction.jl#L197-L203">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.register_dynamic_methods!" href="#PALEOboxes.register_dynamic_methods!"><code>PALEOboxes.register_dynamic_methods!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">register_dynamic_methods!(reaction)
register_dynamic_methods!(reaction, model)</code></pre><p>Optional: called after first variable link pass, to add <a href="#PALEOboxes.ReactionMethod"><code>ReactionMethod</code></a>s that depend on Variables generated by other Reactions (see <a href="#PALEOboxes.register_methods!"><code>register_methods!</code></a>).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Reaction.jl#L209-L216">source</a></section></article><h3 id="VariableReactions"><a class="docs-heading-anchor" href="#VariableReactions">VariableReactions</a><a id="VariableReactions-1"></a><a class="docs-heading-anchor-permalink" href="#VariableReactions" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.VariableReaction" href="#PALEOboxes.VariableReaction"><code>PALEOboxes.VariableReaction</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">VariableReaction</code></pre><p><a href="#PALEOboxes.ReactionMethod"><code>ReactionMethod</code></a> view on a model <code>Domain</code> variable.</p><p>Not created directly - see <a href="#PALEOboxes.CreateVariableReaction"><code>CreateVariableReaction</code></a></p><p><code>localname</code> identifies the <code>VariableReaction</code> within the <code>Reaction</code>. <code>linkreq_domain.linkreq_subdomain.linkreq_name</code> defines the Domain, Subdomain and name for run-time linking to Domain variables. <code>views</code> on Domain data Arrays are created at runtime from <a href="#PALEOboxes.AbstractVarList"><code>AbstractVarList</code></a>s of <code>VariableReaction</code>s and passed to the <a href="#PALEOboxes.ReactionMethod"><code>ReactionMethod</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/VariableReaction.jl#L3-L14">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.CreateVariableReaction" href="#PALEOboxes.CreateVariableReaction"><code>PALEOboxes.CreateVariableReaction</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">CreateVariableReaction(var_type, localnamestr, units, description; 
                       attributes=Tuple(), link_namestr=localnamestr) 
                        -&gt; VariableReaction{T}</code></pre><p>Create a <code>VariableReaction</code>.</p><p>Not called directly: use short names <code>VarProp</code>, <code>VarDep</code>, <code>VarContrib</code>, <code>VarTarget</code>,  <code>VarPropScalar</code>, <code>VarDepScalar</code>, <code>VarContribScalar</code>, <code>VarTargetScalar</code>.</p><p><strong>Arguments</strong></p><ul><li><code>var_type::VariableType</code>:  one of <code>VT_ReactProperty</code>, <code>VT_ReactDependency</code>, <code>VT_ReactContributor</code>, <code>VT_ReactTarget</code></li><li><code>localnamestr::AbstractString</code>: Reaction-local name</li><li><code>units::AbstractString</code>: units (&quot;&quot; if not applicable)</li><li><code>description::AbstractString</code>: text describing the variable</li><li><code>attributes::Tuple(:attrb1name=&gt;attrb1value, :attrb2name=&gt;attrb2value, ...)</code>: </li></ul><p>variable attributes, see <a href="#PALEOboxes.StandardAttributes"><code>StandardAttributes</code></a>, <a href="#PALEOboxes.set_attribute!"><code>set_attribute!</code></a>, <a href="#PALEOboxes.get_attribute"><code>get_attribute</code></a></p><ul><li><code>link_namestr::AbstractString</code>: parsed by <a href="#PALEOboxes.parse_variablereaction_namestr"><code>parse_variablereaction_namestr</code></a> </li></ul><p>to define requested linking to <code>Domain</code> Variable.</p><p>To provide a convenient syntax that handles common cases without separately specifying <code>link_namestr</code>:</p><ul><li>If <code>link_namestr==localnamestr</code> (the default value) <code>localnamestr</code> is parsed to find <code>localname</code> </li></ul><p>(stripping out linking information).</p><ul><li>If <code>link_namestr&#39; is explicitly provided, so</code>link_namestr != localnamestr`,</li></ul><p>then to avoid confusion <code>local_namestr</code> must be just <code>localname</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/VariableReaction.jl#L59-L85">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.parse_variablereaction_namestr" href="#PALEOboxes.parse_variablereaction_namestr"><code>PALEOboxes.parse_variablereaction_namestr</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">parse_variablereaction_namestr(linkstr) 
    -&gt; (linkreq_domain, linkreq_subdomain, linkreq_name, link_optional)</code></pre><p>Parse a linkstr into component parts.</p><p><code>linkstr</code> is of format: <code>[(][&lt;linkreq_domain&gt;.][&lt;linkreq_subdomain&gt;.]&lt;linkreq_name&gt;[)]</code></p><ul><li>Optional brackets <code>( ... )</code> set <code>link_optional=true</code></li><li><code>linkreq_name</code> may contain <code>%reaction%</code> which will later be substituted with <code>&lt;Reaction name&gt;/</code></li></ul><p><strong>Examples:</strong></p><pre><code class="language-julia-repl hljs">julia&gt; PALEOboxes.parse_variablereaction_namestr(&quot;foo&quot;)  # Common case eg for a property that should be public
(&quot;&quot;, &quot;&quot;, &quot;foo&quot;, false)

julia&gt; PALEOboxes.parse_variablereaction_namestr(&quot;%reaction%foo&quot;)  # Reaction-private by default
(&quot;&quot;, &quot;&quot;, &quot;%reaction%foo&quot;, false)

julia&gt; PALEOboxes.parse_variablereaction_namestr(&quot;ocean.foo&quot;)  # Request link to variable of same name in ocean Domain
(&quot;ocean&quot;, &quot;&quot;, &quot;foo&quot;, false)

julia&gt; PALEOboxes.parse_variablereaction_namestr(&quot;(ocean.oceansurface.goo)&quot;) # Full syntax
(&quot;ocean&quot;, &quot;oceansurface&quot;, &quot;goo&quot;, true)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/VariableReaction.jl#L678-L702">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.set_attribute!" href="#PALEOboxes.set_attribute!"><code>PALEOboxes.set_attribute!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">set_attribute!(var::VariableBase, name::Symbol, value, allow_create=false)</code></pre><p>Set Variable attribute.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/VariableAttributes.jl#L7-L11">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.Reservoirs.ReservoirLinksVector" href="#PALEOboxes.Reservoirs.ReservoirLinksVector"><code>PALEOboxes.Reservoirs.ReservoirLinksVector</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">ReservoirLinksVector(reservoirlist) -&gt; (res::Vector, sms::Vector, diag::Vector)</code></pre><p>Convenience function to create variables required for a Reaction to link to a list of Reservoir variables. <code>res</code> contains VariableReactions <code>&lt;reservoir_name&gt;</code>, <code>sms</code> <code>&lt;reservoir_name&gt;_sms</code> that link to <code>State</code>, <code>State_sms</code> variables. <code>diag</code> contains VariableReactions <code>&lt;reservoir_name&gt;_norm</code> etc that link to additional properties.</p><p><strong>Arguments</strong></p><ul><li><code>reservoirlist::[(reservoir_name[::Isotope],       units,   description), ...]</code>: list of Reservoirs</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Reservoirs.jl#L640-L649">source</a></section></article><h3 id="ReactionMethods"><a class="docs-heading-anchor" href="#ReactionMethods">ReactionMethods</a><a id="ReactionMethods-1"></a><a class="docs-heading-anchor-permalink" href="#ReactionMethods" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.ReactionMethod" href="#PALEOboxes.ReactionMethod"><code>PALEOboxes.ReactionMethod</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">ReactionMethod</code></pre><p>Defines a callback function <code>methodfn</code> with Variables <code>vars</code>, to be called from the Model framework either during setup or as part of the main loop.</p><p><strong>Fields</strong></p><ul><li><code>methodfn::Function</code>: callback from Model framework</li><li><code>reaction::AbstractReaction</code>: the Reaction that created this ReactionMethod.</li><li><code>name::String</code>: a descriptive name, eg generated from the name of methodfn</li><li><code>vars::Tuple{Vararg{AbstractVarList}}</code>: <a href="#PALEOboxes.AbstractVarList"><code>AbstractVarList</code></a>s of <a href="#PALEOboxes.VariableReaction"><code>VariableReaction</code></a>s. Corresponding Variable accessors (views on Arrays) will be provided to the <code>methodfn</code> callback.</li><li><code>p::P</code>: optional context field (of arbitrary type) to store data needed by methodfn.</li><li><code>operatorID::Vector{Int64}</code>: operator ID (to allow operator splitting)</li><li><code>domain::Domain</code>: the Domain that <code>methodfn</code> operates on (ie will be called with <code>cellrange</code> for this <code>domain</code>).</li><li><code>preparefn::Function</code>: optional function to eg define buffers before main loop starts.</li></ul><p><strong>methodfn</strong></p><p>The <code>methodfn</code> callback is:</p><pre><code class="nohighlight hljs">methodfn(m::ReactionMethod, vardata::Tuple, cellrange::AbstractCellRange, modelctxt)</code></pre><p>With arguments:</p><ul><li><code>m::ReactionMethod</code>: context is available as <code>m.reaction::AbstractReaction</code> (the Reaction that defined the <code>ReactionMethod</code>), and <code>m.p</code> (an arbitrary extra context field supplied when <code>ReactionMethod</code> created).</li><li><code>vardata</code>: A Tuple of collections of views on Domain data arrays, defined by <code>vars</code></li><li><code>cellrange::AbstractCellRange</code>: range of cells to calculate.</li><li><code>modelctxt</code>:<ul><li>for a setup method, <code>:initial_value</code> or <code>:norm_value</code> defining the type of setup requested</li><li>for a main loop method <code>deltat</code> providing timestep information eg for rate throttling.</li></ul></li></ul><p><strong>preparefn</strong></p><p>An optional <code>preparefn</code> callback can be supplied eg to allocate buffers that require knowledge of the data types of <code>vardata</code> or to cache expensive calculations:</p><pre><code class="nohighlight hljs">preparefn(m::ReactionMethod, vardata::Tuple) -&gt; vardata</code></pre><p>This is called after model arrays are allocated, and prior to setup.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/ReactionMethod.jl#L6-L44">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.add_method_setup!" href="#PALEOboxes.add_method_setup!"><code>PALEOboxes.add_method_setup!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">add_method_setup!(reaction::AbstractReaction, method::AbstractReactionMethod)
add_method_setup!(reaction::AbstractReaction, methodfn::Function, vars::Tuple{Vararg{AbstractVarList}}; kwargs...) -&gt; ReactionMethod</code></pre><p>Add or create-and-add a setup method (called before main loop) eg to set persistent data or initialize state variables. <code>methodfn</code>, <code>vars</code>, <code>kwargs</code> are passed to <a href="#PALEOboxes.ReactionMethod"><code>ReactionMethod</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Reaction.jl#L255-L261">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.add_method_initialize!" href="#PALEOboxes.add_method_initialize!"><code>PALEOboxes.add_method_initialize!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">add_method_initialize!(reaction::AbstractReaction, method::AbstractReactionMethod)
add_method_initialize!(reaction::AbstractReaction, methodfn::Function, vars::Tuple{Vararg{AbstractVarList}}; kwargs...) -&gt; ReactionMethod</code></pre><p>Add or create-and-add an initialize method (called at start of each main loop iteration)  eg to zero out accumulator Variables. <code>methodfn</code>, <code>vars</code>, <code>kwargs</code> are passed to <a href="#PALEOboxes.ReactionMethod"><code>ReactionMethod</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Reaction.jl#L270-L277">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.add_method_do!" href="#PALEOboxes.add_method_do!"><code>PALEOboxes.add_method_do!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">add_method_do!(reaction::AbstractReaction, method::AbstractReactionMethod)
add_method_do!(reaction::AbstractReaction, methodfn::Function, vars::Tuple{Vararg{AbstractVarList}}; kwargs...) -&gt; ReactionMethod</code></pre><p>Add or create and add a main loop method. <code>methodfn</code>, <code>vars</code>, <code>kwargs</code> are passed to <a href="#PALEOboxes.ReactionMethod"><code>ReactionMethod</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Reaction.jl#L287-L293">source</a></section></article><h4 id="Defining-collections-of-Variables"><a class="docs-heading-anchor" href="#Defining-collections-of-Variables">Defining collections of Variables</a><a id="Defining-collections-of-Variables-1"></a><a class="docs-heading-anchor-permalink" href="#Defining-collections-of-Variables" title="Permalink"></a></h4><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.AbstractVarList" href="#PALEOboxes.AbstractVarList"><code>PALEOboxes.AbstractVarList</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">AbstractVarList</code></pre><p>Variables required by a <a href="#PALEOboxes.ReactionMethod"><code>ReactionMethod</code></a> <code>methodfn</code> are specified by  a Tuple of VarList_xxx &lt;: AbstractVarList, each containing a collection of <a href="#PALEOboxes.VariableReaction"><code>VariableReaction</code></a>.</p><p>These are then converted (by the <a href="#PALEOboxes.create_accessors"><code>create_accessors</code></a> method) to a corresponding Tuple of collections of views on Domain data arrays , which are then be passed to the <a href="#PALEOboxes.ReactionMethod"><code>ReactionMethod</code></a> <code>methodfn</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/VariableReaction.jl#L274-L282">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.VarList_single" href="#PALEOboxes.VarList_single"><code>PALEOboxes.VarList_single</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">VarList_single(var; components=false) -&gt; VarList_single</code></pre><p>Create a <code>VarList_single</code> describing a single <code>VariableReaction</code>, <code>create_accessors</code> will then return a single accessor.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/VariableReaction.jl#L301-L306">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.VarList_namedtuple" href="#PALEOboxes.VarList_namedtuple"><code>PALEOboxes.VarList_namedtuple</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">VarList_namedtuple(varcollection; components=false) -&gt; VarList_namedtuple</code></pre><p>Create a <code>VarList_namedtuple</code> describing a collection of <code>VariableReaction</code>s, <code>create_accessors</code> will then return a NamedTuple with field names = <code>VariableReaction.localname</code> and values  as returned by <a href="#PALEOboxes.create_accessor"><code>create_accessor</code></a>. Ordering is preserved.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/VariableReaction.jl#L362-L369">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.VarList_tuple" href="#PALEOboxes.VarList_tuple"><code>PALEOboxes.VarList_tuple</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">VarList_tuple(varcollection; components=false) -&gt; VarList_tuple</code></pre><p>Create a <code>VarList_tuple</code> describing a collection of <code>VariableReaction</code>s, <code>create_accessors</code> will then return a Tuple with values as returned by <a href="#PALEOboxes.create_accessor"><code>create_accessor</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/VariableReaction.jl#L403-L408">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.VarList_vector" href="#PALEOboxes.VarList_vector"><code>PALEOboxes.VarList_vector</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">VarList_vector(varcollection; components=false) -&gt; VarList_vector</code></pre><p>Create a <code>VarList_vector</code> describing a collection of <code>VariableReaction</code>s, <code>create_accessors</code> will then return a Vector with accessors as returned by <a href="#PALEOboxes.create_accessor"><code>create_accessor</code></a>.</p><p><code>forceview</code> option will make each accessor a 1-D <code>view</code> to help type stability, even if this is redundant (ie no <code>view</code> required, v::Vector -&gt; view(v, 1:length(v)))</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/VariableReaction.jl#L422-L430">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.VarList_vvector" href="#PALEOboxes.VarList_vvector"><code>PALEOboxes.VarList_vvector</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">VarList_vvector(Vector{Vector{VariableReaction}}::vars; components=false) -&gt; VarList_vvector</code></pre><p>Create a <code>VarList_vvector</code> describing a Vector of Vectors of <code>VariableReaction</code>s, <code>create_accessors</code> will then return a Vector of Vectors with values as returned by <a href="#PALEOboxes.create_accessor"><code>create_accessor</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/VariableReaction.jl#L445-L450">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.VarList_nothing" href="#PALEOboxes.VarList_nothing"><code>PALEOboxes.VarList_nothing</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">VarList_nothing() -&gt; VarList_nothing</code></pre><p>Create a placeholder for a missing/unavailable VariableReaction. <code>create_accessors</code> will then return <code>nothing</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/VariableReaction.jl#L462-L467">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.VarList_tuple_nothing" href="#PALEOboxes.VarList_tuple_nothing"><code>PALEOboxes.VarList_tuple_nothing</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">VarList_tuple_nothing(nvar) -&gt; VarList_tuple_nothing</code></pre><p>Create a placeholder for <code>nvar</code> missing/unavailable VariableReactions. <code>create_accessors</code> will then return an <code>NTuple{nvar, Nothing}</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/VariableReaction.jl#L474-L479">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.create_accessors" href="#PALEOboxes.create_accessors"><code>PALEOboxes.create_accessors</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">create_accessors(va::AbstractVarList, modeldata::AbstractModelData) -&gt; collection of views</code></pre><p>Call <a href="#PALEOboxes.create_accessor"><code>create_accessor</code></a> to return a collection of views on Domain data arrays for VariableReaction in <code>va</code>. Collection and view are determined by <code>va</code> Type.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/VariableReaction.jl#L286-L291">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.create_accessor" href="#PALEOboxes.create_accessor"><code>PALEOboxes.create_accessor</code></a> — <span class="docstring-category">Function</span></header><section><div><p>get values from <code>linkvar_field</code>, optionally applying view defined by <code>linksubdomain</code></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Fields.jl#L401">source</a></section><section><div><p>provide a create_accessor method for ScalarData –&gt; IsotopeLinear that takes just the first (total) component</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/IsotopeData.jl#L358">source</a></section><section><div><pre><code class="nohighlight hljs"> create_accessor(var::VariableReaction, modeldata, components, [,forceview=false])
    -&gt; accessor or (accessor, subdomain_indices)</code></pre><p>Creates a <code>view</code> on a (single) <a href="#PALEOboxes.VariableDomain"><code>VariableDomain</code></a> data array linked by <code>var::</code><a href="#PALEOboxes.VariableReaction"><code>VariableReaction</code></a>. Called by an <a href="#PALEOboxes.AbstractVarList"><code>AbstractVarList</code></a> <a href="#PALEOboxes.create_accessors"><code>create_accessors</code></a> implementation to generate a collection of <code>views</code> for multiple <a href="#PALEOboxes.VariableReaction"><code>VariableReaction</code></a>s.</p><p>Returns:</p><ul><li>if <code>var</code> is linked, an <code>accessor</code> or Tuple <code>(accessor, subdomain_indices)</code> that provides a <code>view</code> on variable data.</li><li>if <code>var</code> is not linked, <code>nothing</code> if <code>var</code> is optional, or errors and doesn&#39;t return if <code>var</code> is non-optional.</li></ul><p>Mapping of indices for Subdomains &lt;–&gt; Domains:</p><ul><li>if no Subdomain, returns unmodified indices (if <code>forceview=false</code>),    or an equivalent view (if <code>forceview=true</code>, this is to help type stability) </li><li>if Variable is a Domain interior and Subdomain is a Domain boundary,   <code>accessor</code> is a view with a subset of Domain indices.</li><li>if Variable is a Domain boundary and Subdomain is the Domain interior,   returns a Tuple with <code>subdomain_indices</code>,  length(Subdomain size), with <code>missing</code> for interior points.</li></ul><p>Mapping of multi-component (Isotope) Variables:</p><ul><li>If <code>components=false</code>:<ul><li>map multi-component Variable to <code>accessor::IsotopeArray</code></li><li>return a single-component Variable as a <code>accessor::AbstractArray</code>. </li></ul></li><li>If <code>components=true</code>:<ul><li>variable data as a <code>accessor::Vector{Array}</code>, length=number of components</li></ul></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/VariableReaction.jl#L520-L546">source</a></section></article><h3 id="Optimising-loops-over-cells-using-explicit-SIMD-instructions"><a class="docs-heading-anchor" href="#Optimising-loops-over-cells-using-explicit-SIMD-instructions">Optimising loops over cells using explicit SIMD instructions</a><a id="Optimising-loops-over-cells-using-explicit-SIMD-instructions-1"></a><a class="docs-heading-anchor-permalink" href="#Optimising-loops-over-cells-using-explicit-SIMD-instructions" title="Permalink"></a></h3><p>Reactions with simple loops over <code>cellindices</code> that implement time-consuming per-cell calculations  may be optimised by using explicit SIMD instructions.</p><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.SIMDutils.SIMDIter" href="#PALEOboxes.SIMDutils.SIMDIter"><code>PALEOboxes.SIMDutils.SIMDIter</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">SIMDIter(baseiter, Val{N})
SIMDIter(baseiter, ::Type{SIMD.Vec{N, U}})
SIMDIter(baseiter, ::Val{1}) # scalar fallback
SIMDIter(baseiter, ::Type{U}) where {U &lt;: Real} # scalar fallback</code></pre><p>Iterator that takes up to <code>N</code> SIMD elements at a time from <code>baseiter</code> (which should represent indices into a Vector). See Julia package <a href="https://github.com/eschnett/SIMD.jl">SIMD.jl</a></p><p>If <code>baseiter</code> contained 1 or more but less then <code>N</code> elements, then <code>indices</code> is filled with repeats of the last available element.</p><p>Returns Tuple <code>indices</code> (length <code>N</code>).</p><p><strong>Examples</strong></p><pre><code class="nohighlight hljs">v_a = [1.0, 2.0, 3.0, 4.0, 5.0]
v_b = similar(v_a)

iter = eachindex(v_a) # iter should represent indices into a Vector

# simplest version - Float64 x 4, ie type of v_a x 4

for indvec in SIMDIter(iter, Val(4))
    x = v_a[indvec]  # x is a packed SIMD vector
    v_b[indvec] = x
end


# with type conversion - Float32 x 8, ie explicitly change Type of SIMD vector

ST = SIMD.Vec{8, Float32}}    
for indvec in SIMDIter(iter, ST)
    #   v = vec[indvec]  &lt;--&gt; vgatherind(ST, vec, indvec)
    #   vec[indvec] = v  &lt;--&gt; vscatterind!(v, vec, indvec)
    #   vec[indvec] += v &lt;--&gt; vaddind!(v, vec, indvec) 

    x = vgatherind(ST, v_a, indices)  # x is a packed SIMD vector with type conversion to Float32
    vscatterind!(x, v_b, indices)
end</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/SIMDutils.jl#L27-L69">source</a></section></article><h3 id="Predefined-ReactionMethods"><a class="docs-heading-anchor" href="#Predefined-ReactionMethods">Predefined ReactionMethods</a><a id="Predefined-ReactionMethods-1"></a><a class="docs-heading-anchor-permalink" href="#Predefined-ReactionMethods" title="Permalink"></a></h3><h4 id="Setup-and-initialization-of-Variables"><a class="docs-heading-anchor" href="#Setup-and-initialization-of-Variables">Setup and initialization of Variables</a><a id="Setup-and-initialization-of-Variables-1"></a><a class="docs-heading-anchor-permalink" href="#Setup-and-initialization-of-Variables" title="Permalink"></a></h4><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.add_method_setup_initialvalue_vars_default!" href="#PALEOboxes.add_method_setup_initialvalue_vars_default!"><code>PALEOboxes.add_method_setup_initialvalue_vars_default!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">add_method_setup_initialvalue_vars_default!(react::AbstractReaction, variables [; kwargs...])</code></pre><p>Create and add a default method to initialize Variables matching <code>filterfn</code> (defaults to state Variables) to Attribute :initial_value at beginning of integration.</p><p><strong>Keywords</strong></p><ul><li><code>filterfn</code>: set to f(var)::Bool to override the default selection on :vfunction for state variables.</li><li><code>transfer_attribute_vars=[]</code>: Set to a list of the same length as <code>variables</code> to initialise <code>variables</code> from attributes of <code>transfer_attribute_vars</code>.</li><li><code>setup_callback=(method, attribute_value, var, vardata) -&gt; nothing</code>: Set to a function that is called  after each Variable initialisation eg to store norm values.</li><li><code>convertvars=[]</code></li><li><code>convertfn = (convertvars_tuple, i) -&gt; 1.0</code></li><li><code>convertinfo = &quot;&quot;</code></li></ul><p><strong>Including volume etc conversion</strong></p><p>Set <code>convertvars</code> to a Vector of Variables (eg for cell volume) and supply <code>convertfn</code> and <code>convertinfo</code>  to initialize to <code>:initial_value*convertfn(convertvars_tuple, i)</code> where the argument of <code>convertfn</code> is the Tuple generated by <code>VarList_tuple(convertvars)</code>.</p><p>Example: To interpret :initial_value as a concentration-like quantity:</p><pre><code class="nohighlight hljs">convertvars = [volume], 
convertfn = ((volume, ), i) -&gt; volume[i], 
convertinfo = &quot; * volume&quot;</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/ReactionMethod.jl#L159-L186">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.add_method_initialize_zero_vars_default!" href="#PALEOboxes.add_method_initialize_zero_vars_default!"><code>PALEOboxes.add_method_initialize_zero_vars_default!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">add_method_initialize_zero_vars_default!(react::AbstractReaction, variables=PB.get_variables(react))</code></pre><p>Create and add a default method to initialize Variables to zero at beginning of each timestep. Defaults to adding all Variables from <code>react</code> with <code>:initialize_to_zero</code> attribute <code>true</code>.</p><p>NB: TODO variables are converted to VarDep (no dependency checking or sorting needed, could define a VarInit or similar?)</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/ReactionMethod.jl#L262-L269">source</a></section></article><h4 id="Adding-totals-for-Variables"><a class="docs-heading-anchor" href="#Adding-totals-for-Variables">Adding totals for Variables</a><a id="Adding-totals-for-Variables-1"></a><a class="docs-heading-anchor-permalink" href="#Adding-totals-for-Variables" title="Permalink"></a></h4><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.add_method_do_totals_default!" href="#PALEOboxes.add_method_do_totals_default!"><code>PALEOboxes.add_method_do_totals_default!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">add_method_do_totals_default!(react::AbstractReaction, variables=PB.get_variables(react))</code></pre><p>Create and add a default method to initialize Variables to zero at beginning of each timestep. Defaults to adding all Variables from <code>react</code> with <code>:initialize_to_zero</code> attribute <code>true</code>.</p><p>NB: TODO variables are converted to VarDep (no dependency checking or sorting needed, could define a VarInit or similar?)</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/VariableStatsMethods.jl#L1-L8">source</a></section></article><h4 id="Chemical-reactions"><a class="docs-heading-anchor" href="#Chemical-reactions">Chemical reactions</a><a id="Chemical-reactions-1"></a><a class="docs-heading-anchor-permalink" href="#Chemical-reactions" title="Permalink"></a></h4><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.RateStoich" href="#PALEOboxes.RateStoich"><code>PALEOboxes.RateStoich</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">RateStoich(ratevartemplate, stoich_statevarname; deltavarname_eta=nothing,
           sms_prefix=&quot;&quot;, sms_suffix=&quot;_sms&quot;) -&gt; RateStoich</code></pre><p>Calculate fluxes for a biogeochemical reaction given rate, stoichiometry, and optionally isotope eta.</p><p>Add to a Reaction using <a href="#PALEOboxes.create_ratestoich_method"><code>create_ratestoich_method</code></a> and <a href="#PALEOboxes.add_method_do!"><code>add_method_do!</code></a>.  </p><p>A Property Variable should be set to provide the reaction rate (often this is implemented by another method of the same Reaction).</p><p>This method will then link to that (using the local and link names supplied by <code>ratevartemplate</code>) and calculate the appropriate product rates, omitting products that are not present (<code>VariableReaction</code> not linked) in the <code>Model</code> configuration.</p><p><strong>Arguments:</strong></p><ul><li><code>ratevartemplate::Union{VarPropT, VarDepT}</code>: used to define the rate variable local and link names.</li><li><code>stoich_statevarname</code>: collection of Tuple(stoichiometry, name) eg ((-2.0, &quot;O2&quot;), (-1.0,&quot;H2S::Isotope&quot;), (1.0, &quot;SO4::Isotope&quot;))</li><li><code>deltavarname_eta</code>: optional tuple of variable delta + eta (&quot;SO4_delta&quot;, -30.0) or (&quot;SO4_delta&quot;, rj.pars.delta). If a Parameter is supplied, this is read in <code>do_react_ratestoich</code> to allow modification.</li></ul><p><strong>Examples:</strong></p><p>Create a <code>RateStoich</code> representing the reaction   2 O2 + H2S -&gt; H2SO4</p><pre><code class="language-julia-repl hljs">julia&gt; myratevar = PALEOboxes.VarProp(&quot;myrate&quot;, &quot;mol yr-1&quot;, &quot;a rate&quot;);

julia&gt; rs = PALEOboxes.RateStoich(myratevar, ((-2.0, &quot;O2&quot;), (-1.0,&quot;H2S&quot;), (1.0, &quot;SO4&quot;)));

julia&gt; rs.stoich_statevarname
((-2.0, &quot;O2&quot;), (-1.0, &quot;H2S&quot;), (1.0, &quot;SO4&quot;))</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/RateStoich.jl#L2-L31">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.create_ratestoich_method" href="#PALEOboxes.create_ratestoich_method"><code>PALEOboxes.create_ratestoich_method</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">create_ratestoich_method(reaction::AbstractReaction, ratestoich::RateStoich; isotope_data=ScalarData)
    -&gt; ReactionMethod</code></pre><p>Create method (see <a href="#PALEOboxes.RateStoich"><code>RateStoich</code></a>).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/RateStoich.jl#L102-L107">source</a></section></article><h2 id="Reservoirs"><a class="docs-heading-anchor" href="#Reservoirs">Reservoirs</a><a id="Reservoirs-1"></a><a class="docs-heading-anchor-permalink" href="#Reservoirs" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.Reservoirs.ReactionReservoirScalar" href="#PALEOboxes.Reservoirs.ReactionReservoirScalar"><code>PALEOboxes.Reservoirs.ReactionReservoirScalar</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">ReactionReservoirScalar</code></pre><p>A single scalar biogeochemical reservoir with optional paired isotope reservoir, for use in a 0D Domain  (eg sedimentary or ocean reservoirs for COPSE <a href="../References/#Bergman2004">N. M. Bergman, Timothy M Lenton, Andrew J Watson (2004)</a>).</p><p>Creates State and associated Variables, depending on parameter settings:</p><ul><li><code>const=false, stateexplicit=true</code>: usual case, create state variable <code>R</code> (units mol, with attribute <code>vfunction=VF_StateExplicit</code>) and <code>R_sms</code> (units mol yr-1, with attribute <code>vfunction=VF_Deriv</code>).</li><li><code>const=true, stateexplicit=true</code>: a constant value, create <code>R</code> (a Property)</li><li><code>const=false, stateexplicit=false</code>: for use with an implicit state variable, create <code>R_sms</code> (with attribute <code>vfunction=VF_Deriv</code>) and a Dependency <code>R</code> (which  should be linked to a Variable with attribute <code>vfunction=VF_Total</code> calculated elsewhere, which should also set up initial value). </li></ul><p>In addition:</p><ul><li>a Property <code>R_norm</code> (normalized value) is always created.</li><li>if parameter <code>field_data &lt;: AbstractIsotopeScalar</code> (eg <code>IsotopeLinear</code>), a Property <code>R_delta</code> is created.</li></ul><p>The local name prefix <code>R</code> should then be renamed using <code>variable_links:</code> in the configuration file.</p><p><strong>Initialisation</strong></p><ul><li><code>state_explicit=true</code>: (the usual case) initial and norm value is set in the <code>variable_attributes:</code> section in  the configuration file, using <code>R:initial_value</code>, <code>R:initial_delta</code>, and <code>R:norm_value</code>.</li><li><code>state_explicit=false</code>: initial and norm values should be set by the linked implicit state Variable</li></ul><p><strong>Example configuration in .yaml file</strong></p><pre><code class="nohighlight hljs">            reservoir_P:  # 0D ocean Phosphorus
                class: ReactionReservoirScalar
                parameters:
                    # field_data: ScalarData        # change to IsotopeLinear to represent an isotope
                    # const: false                  # true to fix to constant value
                variable_links:
                    R*: P                           # rename to represent Phosphorus
                variable_attributes:
                    R:norm_value:           3.1e15  # mol 
                    R:initial_value:        3.1e15  # mol</code></pre><p><strong>See also</strong></p><p><a href="#PALEOboxes.Reservoirs.ReactionReservoir"><code>ReactionReservoir</code></a> (one value per cell for a spatially resolved Domain eg ocean), <a href="#PALEOboxes.Reservoirs.ReactionReservoirWellMixed"><code>ReactionReservoirWellMixed</code></a> (one value for a whole spatially resolved Domain).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Reservoirs.jl#L8-L47">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.Reservoirs.ReactionReservoir" href="#PALEOboxes.Reservoirs.ReactionReservoir"><code>PALEOboxes.Reservoirs.ReactionReservoir</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">ReactionReservoir,  ReactionReservoirTotal</code></pre><p>A single (vector) reservoir (state variable) representing a biogeochemical tracer, ie one value per cell in a spatially-resolved Domain (eg ocean).</p><p>State Variables created depend on parameters:</p><ul><li><code>stateexplicit=true</code>: usual case to represent an ODE variable and time derivative, create state variable  <code>R</code> (mol m-3, with attribute <code>vfunction=VF_StateExplicit</code>) and <code>R_sms</code> (mol m-3 yr-1, with attribute <code>vfunction=VF_Deriv</code>).</li><li><code>stateexplicit=false</code>: for use with an ODE implicit state variable, create <code>R_sms</code> (with attribute <code>vfunction=VF_Deriv</code>) and a Dependency <code>R</code> (which  should be linked to a Variable with attribute <code>vfunction=VF_Total</code> calculated elsewhere, this Variable should also set the initial value). </li></ul><p>In addition:</p><ul><li>a Property <code>R_conc</code> (concentration in mol m-3) is always created.</li><li>if parameter <code>field_data &lt;: AbstractIsotopeScalar</code> (eg <code>IsotopeLinear</code>), a Property <code>R_delta</code> is created.</li><li><code>ReactionReservoirTotal</code> also calculates the Domain total <code>R_total</code> (units mol), eg to check budgets.</li></ul><p>Local name prefix <code>R</code> should then be renamed using <code>variable_links:</code> in the configuration file.</p><p><strong>Initialisation</strong></p><p>Initial value is set using <code>variable_attributes:</code> in the configuration file, using <code>R:initial_value</code> and <code>R:initial_delta</code> (NB: although <code>initial_value</code> is set on <code>R</code>, it <em>sets concentration in <code>mol m-3</code></em>.)</p><p>Transport is defined by attributes <code>:advect</code>, <code>:vertical_movement</code> (m d-1) set on the concentration variable <code>R_conc</code>. Optical extinction is defined by the <code>:specific_light_extinction</code> (m^2 mol-1) attribute set on the concentration variable <code>R_conc</code>.</p><p><strong>Example configuration in .yaml file</strong></p><pre><code class="nohighlight hljs">            reservoir_P:  # ocean Phosphorus
                class: ReactionReservoirTotal       # include _total (mol)
                parameters:
                    # field_data: ScalarData        # change to IsotopeLinear to represent an isotope                       
                variable_links:
                    R*: P                           # rename to represent Phosphorus
                variable_attributes:
                    R:norm_value:           3e-3    # mol m-3, normalisation value (used by some solvers)
                    R:initial_value:        2e-3    # mol m-3, initial concentration</code></pre><p><strong>See also</strong></p><p><a href="#PALEOboxes.Reservoirs.ReactionReservoirWellMixed"><code>ReactionReservoirWellMixed</code></a> (one value for the whole Domain), <a href="#PALEOboxes.Reservoirs.ReactionReservoirScalar"><code>ReactionReservoirScalar</code></a> (one value for a reservoir in a 0D Domain eg for COPSE <a href="../References/#Bergman2004">N. M. Bergman, Timothy M Lenton, Andrew J Watson (2004)</a>), <a href="#PALEOboxes.Reservoirs.ReactionReservoirConst"><code>ReactionReservoirConst</code></a> (constant time-independent value ie no state variable). </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Reservoirs.jl#L126-L167">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.Reservoirs.ReactionReservoirWellMixed" href="#PALEOboxes.Reservoirs.ReactionReservoirWellMixed"><code>PALEOboxes.Reservoirs.ReactionReservoirWellMixed</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">ReactionReservoirWellMixed</code></pre><p>A Scalar Reservoir representing a well-mixed tracer in a vector Domain (eg ocean). Provides a scalar state Variable <code>R</code> and <code>R_sms</code>, and also vector Variables: <code>R_conc</code> (set to uniform concentration), and <code>R_vec_sms</code> Target for accumulating fluxes that is added to the scalar <code>R_sms</code>. </p><p><strong>Initialisation</strong></p><p>Initial value is set in the <code>variable_attributes:</code> section in the configuration file, using <code>R:initial_value</code> and <code>R:initial_delta</code>. NB: may be initialized either from mean concentration or total (set by parameter <code>initialization_type</code>)</p><p>TODO salinity normalisation.</p><p><strong>See also</strong></p><p><a href="#PALEOboxes.Reservoirs.ReactionReservoir"><code>ReactionReservoir</code></a> (one value per cell), <a href="#PALEOboxes.Reservoirs.ReactionReservoirScalar"><code>ReactionReservoirScalar</code></a> (one value for a reservoir in a 0D Domain eg for COPSE <a href="../References/#Bergman2004">N. M. Bergman, Timothy M Lenton, Andrew J Watson (2004)</a>). </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Reservoirs.jl#L417-L433">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.Reservoirs.ReactionReservoirConst" href="#PALEOboxes.Reservoirs.ReactionReservoirConst"><code>PALEOboxes.Reservoirs.ReactionReservoirConst</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">ReactionReservoirConst</code></pre><p>A single (vector) constant tracer <code>R_conc</code> (constant replacement for a <a href="#PALEOboxes.Reservoirs.ReactionReservoir"><code>ReactionReservoir</code></a>).</p><p>Local name prefix <code>R</code> should then be renamed using <code>variable_links:</code> in the configuration file.</p><p><strong>Initialisation</strong></p><p>Set <code>:initial_value</code>, <code>:initial_delta</code> on <code>R_conc</code> (mol m-3) in the <code>variable_attributes:</code> section of the config file.</p><p>TODO salinity normalisation.</p><p><strong>Example configuration in .yaml file</strong></p><pre><code class="nohighlight hljs">            reservoir_B:  # Constant value for ocean Boron 
                class: ReactionReservoirConst
                parameters:
                    field_data: IsotopeLinear
                variable_links:
                    R*: B
                variable_attributes:                      
                    R_conc:initial_value:       0.4269239 # contemporary value
                    R_conc:initial_delta:       34.0</code></pre><p><strong>See also</strong></p><p><a href="#PALEOboxes.Reservoirs.ReactionReservoir"><code>ReactionReservoir</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Reservoirs.jl#L276-L302">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.Reservoirs.ReactionReservoirForced" href="#PALEOboxes.Reservoirs.ReactionReservoirForced"><code>PALEOboxes.Reservoirs.ReactionReservoirForced</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">ReactionReservoirForced</code></pre><p>A single (vector) constant tracer (constant replacement for a <a href="#PALEOboxes.Reservoirs.ReactionReservoir"><code>ReactionReservoir</code></a>), with forcing.</p><p>Calculates <code>R_conc = R_conc_initial * R_FORCE</code>.</p><p>Local name prefix <code>R</code> should then be renamed using <code>variable_links:</code> in the configuration file.</p><p><strong>Initialisation</strong></p><p>NB: set <code>:initial_value</code>, <code>:initial_delta</code> on <code>R_conc_initial</code> in the <code>variable_attributes:</code> section of the config file.</p><p>TODO salinity normalisation.</p><p><strong>See also</strong></p><p><a href="#PALEOboxes.Reservoirs.ReactionReservoirConst"><code>ReactionReservoirConst</code></a>, <a href="#PALEOboxes.Reservoirs.ReactionReservoir"><code>ReactionReservoir</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Reservoirs.jl#L342-L359">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.Reservoirs.ReactionConst" href="#PALEOboxes.Reservoirs.ReactionConst"><code>PALEOboxes.Reservoirs.ReactionConst</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">ReactionConst, ReactionScalarConst</code></pre><p>Create constant Property Variables with names from parameter <code>constnames</code>. </p><p><strong>Initialisation</strong></p><p>Constant values set by <code>:initial_value</code>, <code>:initial_delta</code> attributes in the <code>variable_attributes:</code> section of the configuration file.</p><p><strong>Example configuration in .yaml file</strong></p><pre><code class="nohighlight hljs">    atmfloor:
        reactions:                
            floorstubgasmr:  # Provide mixing-ratio boundary condition for a subset of atmospheric variables
                class: ReactionConst
                parameters:
                    constnames: [&quot;O2_mr&quot;, &quot;CH4_mr&quot;, &quot;CO2_mr&quot;, &quot;H2_mr&quot;] #, &quot;H2O_mr&quot;]  
                variable_attributes:        
                    O2_mr:initial_value:  [0.21]  # mol/mol
                    CH4_mr:initial_value:  [0.7443e-6] # [.NaN] # [1.271e-6] # [1.8e-6]  # mol/mol
                    CO2_mr:initial_value:  [300e-6]  # mol/mol
                    H2_mr:initial_value:   [.NaN]  # mol/mol</code></pre><p><strong>See also</strong></p><p><a href="#PALEOboxes.Reservoirs.ReactionReservoirConst"><code>ReactionReservoirConst</code></a>, <a href="#PALEOboxes.Reservoirs.ReactionReservoirScalar"><code>ReactionReservoirScalar</code></a>.  These provide additional variables (eg <code>R_delta</code>) to  allow them to function as a drop-in replacement for a non-constant Reservoir.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Reservoirs.jl#L555-L579">source</a></section></article><h2 id="Variable-Statistics"><a class="docs-heading-anchor" href="#Variable-Statistics">Variable Statistics</a><a id="Variable-Statistics-1"></a><a class="docs-heading-anchor-permalink" href="#Variable-Statistics" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.VariableStats.ReactionSum" href="#PALEOboxes.VariableStats.ReactionSum"><code>PALEOboxes.VariableStats.ReactionSum</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">ReactionSum, ReactionVectorSum</code></pre><p>A sum of variables (eg budget).</p><ul><li>If Parameter <code>component_to_add == 0</code>, all components of Isotopes are included.</li><li>If Parameter <code>component_to_add == component_number</code>, a single component only is included.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/VariableStats.jl#L9-L15">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.VariableStats.ReactionWeightedMean" href="#PALEOboxes.VariableStats.ReactionWeightedMean"><code>PALEOboxes.VariableStats.ReactionWeightedMean</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">ReactionWeightedMean</code></pre><p>Weighted mean (eg by area or volume) of Variable</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/VariableStats.jl#L179-L183">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.VariableStats.ReactionAreaVolumeValInRange" href="#PALEOboxes.VariableStats.ReactionAreaVolumeValInRange"><code>PALEOboxes.VariableStats.ReactionAreaVolumeValInRange</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">ReactionAreaVolumeValInRange</code></pre><p>Fraction of Domain area or volume with Variable in a range of values.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/VariableStats.jl#L226-L230">source</a></section></article><h2 id="Fluxes"><a class="docs-heading-anchor" href="#Fluxes">Fluxes</a><a id="Fluxes-1"></a><a class="docs-heading-anchor-permalink" href="#Fluxes" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.Fluxes" href="#PALEOboxes.Fluxes"><code>PALEOboxes.Fluxes</code></a> — <span class="docstring-category">Module</span></header><section><div><pre><code class="language-julia hljs">Fluxes</code></pre><p>Create and manage collections of Target and Contrib Variables used to define fluxes within or between Domains.</p><p><strong>Conventions for defining biogeochemical fluxes within Domains</strong></p><ul><li>Particulate organic matter (including CaCO3) with stoichiometry Corg:N:P:Ccarb is usually transferred as: <code>flux_list</code> <code>[&quot;P&quot;, &quot;N&quot;, &quot;Corg::CIsotope&quot;, &quot;Ccarb::CIsotope&quot;]</code> with a prefix indicating the function (eg <code>export_</code>).</li><li>Solute fluxes are usually transferred as: <code>flux_list</code>  <code>[&quot;DIC::CIsotope&quot;, &quot;TAlk&quot;, &quot;Ca&quot;, &quot;P&quot;, &quot;O2&quot;, &quot;SO4::SIsotope&quot;, &quot;H2S::SIsotope&quot;, &quot;CH4::CIsotope&quot;]</code> (where these names match the Reservoir names for the solutes), with a prefix indicating the function (usually just <code>flux_</code> or <code>soluteflux_</code>).</li></ul><p><strong>Conventions for defining global fluxes between modules</strong></p><p>The model configuration <code>.yaml</code> file should create  a <code>Domain</code> for each global flux, containing one or more <a href="#PALEOboxes.Fluxes.ReactionFluxTarget"><code>Fluxes.ReactionFluxTarget</code></a>.  Fluxes are then transferred (copied) by adding a <a href="#PALEOboxes.Fluxes.ReactionFluxTransfer"><code>Fluxes.ReactionFluxTransfer</code></a> to each destination Domain.</p><p>Naming conventions for Earth system fluxes:</p><table><tr><th style="text-align: left">Domain name</th><th style="text-align: left">target prefix</th><th style="text-align: left">flux_list (illustrative, add as needed)</th></tr><tr><td style="text-align: left">fluxAtoLand</td><td style="text-align: left">flux_</td><td style="text-align: left">[&quot;CO2::CIsotope&quot;, &quot;O2&quot;]</td></tr><tr><td style="text-align: left">fluxRtoOcean</td><td style="text-align: left">flux_</td><td style="text-align: left">[&quot;DIC::CIsotope&quot;, &quot;TAlk&quot;, &quot;Ca&quot;, &quot;P&quot;, &quot;SO4::SIsotope&quot;]</td></tr><tr><td style="text-align: left">fluxOceanBurial</td><td style="text-align: left">flux_</td><td style="text-align: left">[&quot;Corg::CIsotope&quot;, &quot;Ccarb::CIsotope&quot;, &quot;Porg&quot;, &quot;Pauth&quot;, &quot;PFe&quot;, &quot;P&quot;, &quot;GYP::SIsotope&quot;, &quot;PYR::SIsotope&quot;]</td></tr><tr><td style="text-align: left">fluxSedCrusttoAOcean</td><td style="text-align: left">flux_</td><td style="text-align: left">[&quot;C::CIsotope&quot;, &quot;S::SIsotope&quot;, &quot;Redox&quot;]</td></tr><tr><td style="text-align: left">fluxLandtoSedCrust</td><td style="text-align: left">flux_</td><td style="text-align: left">[&quot;Ccarb::CIsotope&quot;, &quot;Corg::CIsotope&quot;, &quot;GYP::SIsotope&quot;, &quot;PYR::SIsotope&quot;]</td></tr><tr><td style="text-align: left">fluxOceanfloor</td><td style="text-align: left">particulateflux_</td><td style="text-align: left">[&quot;P&quot;, &quot;N&quot;, &quot;Corg::CIsotope&quot;, &quot;Ccarb::CIsotope&quot;]</td></tr><tr><td style="text-align: left"></td><td style="text-align: left">soluteflux_</td><td style="text-align: left">[&quot;DIC::CIsotope&quot;, &quot;TAlk&quot;, &quot;Ca&quot;, &quot;P&quot;, &quot;O2&quot;, &quot;SO4::SIsotope&quot;, &quot;H2S::SIsotope&quot;, &quot;CH4::CIsotope&quot;]</td></tr><tr><td style="text-align: left">fluxAtmtoOceansurface</td><td style="text-align: left">flux_</td><td style="text-align: left">[&quot;CO2::CIsotope&quot;, &quot;CH4::CIsotope&quot;, &quot;O2&quot;]</td></tr></table></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Fluxes.jl#L1-L35">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.Fluxes.ReactionFluxTarget" href="#PALEOboxes.Fluxes.ReactionFluxTarget"><code>PALEOboxes.Fluxes.ReactionFluxTarget</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">ReactionFluxTarget</code></pre><p>Provides either a target for fluxes from <code>fluxlist</code> in an input <code>Domain</code> or a constant stub, optionally calculates totals.</p><p>For each <code>fluxname</code> in <code>fluxlist</code>, creates:</p><ul><li>if <code>const_stub==false</code>, an input <code>VarTarget</code> <code>pars.target_prefix.v*&quot;flux_&quot;*fluxname</code> (or if <code>const_stub==true</code>, a constant <code>VarProp</code>).</li><li>if <code>flux_totals</code> is <code>true</code>, a total <code>VarPropScalar</code> <code>target_prefix.v*&quot;flux_total_&quot;*fluxname</code>.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Fluxes.jl#L141-L151">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.Fluxes.ReactionFluxTransfer" href="#PALEOboxes.Fluxes.ReactionFluxTransfer"><code>PALEOboxes.Fluxes.ReactionFluxTransfer</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">ReactionFluxTransfer</code></pre><p>Copy fluxes, optionally using transfer matrices to define cell-cell mappings if input and output fluxes  are in a different Domain.</p><p>A transfer is defined by Parameters:</p><ul><li><code>input_fluxes</code>: A list of input Variables generated by matches to string  <code>[inputdomain.][inputsubdomain.]prefix$fluxname$suffix</code> where <code>$fluxname$</code> matches any string. These have local names <code>input_$fluxname$</code>.</li><li><code>output_fluxes</code>: Corresponding list of output Variables. <code>[outputdomain.][outputsubdomain.]prefix$fluxname$suffix</code> where <code>$fluxname$</code> is generated from matches of <code>input_fluxes</code>. These have local names <code>output_$fluxname$</code> and are optional (ie ignored if not linked). Usually the output Domain is the Domain hosting the <code>ReactionFluxTransfer</code> (in general, it must be a Domain of the same size as the Domain hosting the <code>ReactionFluxTransfer</code>).</li><li><code>transfer_multiplier</code>: A scalar multiplier (usually 1.0).</li><li><code>transfer_matrix</code>: Form of transfer matrix.<ul><li>&#39;Identity&#39; copies fluxes directly assuming the output Domain has the same size as the input Domain.</li><li>&#39;Distribute&#39; uniformly distributes fluxes from input -&gt; output, including common cases n -&gt; 1 (input flux is summed to a scalar output), 1 -&gt; m (scalar input is distributed uniformly to m output cells).</li></ul></li></ul><p>There are three common cases:</p><ul><li>Transfer within a Domain, using <code>transfer_matrix</code> <code>Identity</code></li><li>Transfer from a <code>fluxXXX</code> Domain to the Domain hosting the <code>ReactionFluxTransfer</code>, using <code>transfer_matrix</code> to define a mapping if these Domains are of different sizes.  </li><li>Transfer from a <code>fluxXXX</code> Domain to the boundary cells of an interior Domain (eg <code>ocean.oceansurface</code>),  where the Domain hosting the <code>ReactionFluxTransfer</code> is the corresponding boundary Domain (eg <code>oceansurface</code>).</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Fluxes.jl#L228-L255">source</a></section></article><h3 id="Contributing-to-flux-couplers-from-a-Reaction"><a class="docs-heading-anchor" href="#Contributing-to-flux-couplers-from-a-Reaction">Contributing to flux couplers from a Reaction</a><a id="Contributing-to-flux-couplers-from-a-Reaction-1"></a><a class="docs-heading-anchor-permalink" href="#Contributing-to-flux-couplers-from-a-Reaction" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.Fluxes.FluxContrib" href="#PALEOboxes.Fluxes.FluxContrib"><code>PALEOboxes.Fluxes.FluxContrib</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">FluxContrib(
    fluxprefix::AbstractString, flux_list;
    isotope_data::Dict,
    [, space=PB.CellSpace][, alloptional=true]
) -&gt; vartuple::NamedTuple</code></pre><p>Create a <code>NamedTuple</code> of <code>VarContrib</code> from <code>flux_prefix.*flux_list</code>, needed for a Reaction to write to a flux coupler. Entries in <code>flux_list</code> of form <code>fluxname::isotope</code> are parsed to look up isotope type from <code>isotope_data</code> Dict.</p><p>For each <code>fluxname</code> in <code>flux_list</code>, the generated <code>VarContrib</code> <code>vartuple.fluxname</code> have <code>link_namestr=$(fluxprefix)$(fluxname)&quot;</code> and  <code>localname=&quot;$(fluxprefix)$(fluxname)</code> (with any <code>.</code> in <code>fluxprefix</code> substituted to <code>_</code>).</p><p><strong>Example:</strong></p><pre><code class="language-julia hljs">julia&gt; fluxRtoOcean = PB.Fluxes.FluxContrib(&quot;fluxRtoOcean.flux_&quot;, [&quot;P&quot;, &quot;SO4::SIsotope&quot;], isotope_data=Dict(&quot;SIsotope&quot;=&gt;PB.IsotopeLinear), space=PB.ScalarSpace);

julia&gt; fluxRtoOcean.P
PALEOboxes.VariableReaction{PALEOboxes.VT_ReactContributor}
  localname=&#39;fluxRtoOcean_flux_P&#39;
  link_name=&#39;fluxRtoOcean.flux_P[unlinked]&#39;
  attributes=Dict{Symbol, Any}(:description =&gt; &quot;flux P&quot;, :space =&gt; PALEOboxes.ScalarSpace, :standard_variable =&gt; false, :norm_value =&gt; 1.0, :data_dims =&gt; String[], :long_name =&gt; &quot;&quot;, :vfunction =&gt; PALEOboxes.VF_Undefined, :field_data =&gt; PALEOboxes.ScalarData, :initial_delta =&gt; 0.0, :units =&gt; &quot;mol yr-1&quot;…)

julia&gt; fluxRtoOcean.SO4
PALEOboxes.VariableReaction{PALEOboxes.VT_ReactContributor}
  localname=&#39;fluxRtoOcean_flux_SO4&#39;
  link_name=&#39;fluxRtoOcean.flux_SO4[unlinked]&#39;
  attributes=Dict{Symbol, Any}(:description =&gt; &quot;flux SO4&quot;, :space =&gt; PALEOboxes.ScalarSpace, :standard_variable =&gt; false, :norm_value =&gt; 1.0, :data_dims =&gt; String[], :long_name =&gt; &quot;&quot;, :vfunction =&gt; PALEOboxes.VF_Undefined, :field_data =&gt; PALEOboxes.IsotopeLinear, :initial_delta =&gt; 0.0, :units =&gt; &quot;mol yr-1&quot;…)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/8fe384f8ba8a8610a6af307e64c67e99aa8c6d1a/src/Fluxes.jl#L44-L74">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../CreateInitializeLoop/">« Control flow</a><a class="docs-footer-nextpage" href="../References/">References »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.15 on <span class="colophon-date" title="Friday 15 April 2022 19:18">Friday 15 April 2022</span>. Using Julia version 1.6.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
