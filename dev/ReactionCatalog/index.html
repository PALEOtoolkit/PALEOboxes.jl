<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Generic Reaction catalog · PALEOboxes Documentation</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">PALEOboxes Documentation</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Design</span><ul><li><a class="tocitem" href="../DesignOverview/">Outline of PALEO design</a></li><li><a class="tocitem" href="../CreateInitializeLoop/">Control flow</a></li></ul></li><li><span class="tocitem">Reference</span><ul><li><a class="tocitem" href="../DomainsVariablesFields/">Domains, Variables, Fields, and Data arrays.</a></li><li><a class="tocitem" href="../Solver API/">Solver API</a></li><li><a class="tocitem" href="../Reaction API/">Reaction API</a></li><li class="is-active"><a class="tocitem" href>Generic Reaction catalog</a><ul class="internal"><li><a class="tocitem" href="#Reservoirs"><span>Reservoirs</span></a></li><li><a class="tocitem" href="#Variable-Statistics"><span>Variable Statistics</span></a></li><li><a class="tocitem" href="#Fluxes"><span>Fluxes</span></a></li><li><a class="tocitem" href="#Forcings"><span>Forcings</span></a></li><li><a class="tocitem" href="#Grids"><span>Grids</span></a></li></ul></li></ul></li><li><a class="tocitem" href="../References/">References</a></li><li><a class="tocitem" href="../indexpage/">Index</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Reference</a></li><li class="is-active"><a href>Generic Reaction catalog</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Generic Reaction catalog</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/master/docs/src/ReactionCatalog.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Generic-Reaction-catalog"><a class="docs-heading-anchor" href="#Generic-Reaction-catalog">Generic Reaction catalog</a><a id="Generic-Reaction-catalog-1"></a><a class="docs-heading-anchor-permalink" href="#Generic-Reaction-catalog" title="Permalink"></a></h1><p>PALEOboxes includes a catalog of generic Reactions as a starting point for model construction.</p><h2 id="Reservoirs"><a class="docs-heading-anchor" href="#Reservoirs">Reservoirs</a><a id="Reservoirs-1"></a><a class="docs-heading-anchor-permalink" href="#Reservoirs" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.Reservoirs.ReactionReservoirScalar" href="#PALEOboxes.Reservoirs.ReactionReservoirScalar"><code>PALEOboxes.Reservoirs.ReactionReservoirScalar</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">ReactionReservoirScalar</code></pre><p>A single scalar biogeochemical reservoir with optional paired isotope reservoir, for use in a 0D Domain  (eg sedimentary or ocean reservoirs for COPSE <a href="../References/#Bergman2004">N. M. Bergman, Timothy M Lenton, Andrew J Watson (2004)</a>).</p><p>Creates State and associated Variables, depending on parameter settings:</p><ul><li><code>const=false, stateexplicit=true</code>: usual case, create state variable <code>R</code> (units mol, with attribute <code>vfunction=VF_StateExplicit</code>) and <code>R_sms</code> (units mol yr-1, with attribute <code>vfunction=VF_Deriv</code>).</li><li><code>const=true, stateexplicit=true</code>: a constant value, create <code>R</code> (a Property)</li><li><code>const=false, stateexplicit=false</code>: for use with an implicit state variable, create <code>R_sms</code> (with attribute <code>vfunction=VF_Deriv</code>) and a Dependency <code>R</code> (which  should be linked to a Variable with attribute <code>vfunction=VF_Total</code> calculated elsewhere, which should also set up initial value). </li></ul><p>In addition:</p><ul><li>a Property <code>R_norm</code> (normalized value) is always created.</li><li>if parameter <code>field_data &lt;: AbstractIsotopeScalar</code> (eg <code>IsotopeLinear</code>), a Property <code>R_delta</code> is created.</li></ul><p>The local name prefix <code>R</code> should then be renamed using <code>variable_links:</code> in the configuration file.</p><p><strong>Initialisation</strong></p><ul><li><code>state_explicit=true</code>: (the usual case) initial and norm value is set in the <code>variable_attributes:</code> section in  the configuration file, using <code>R:initial_value</code>, <code>R:initial_delta</code>, and <code>R:norm_value</code>.</li><li><code>state_explicit=false</code>: initial and norm values should be set by the linked implicit state Variable</li></ul><p><strong>Example configuration in .yaml file</strong></p><pre><code class="nohighlight hljs">            reservoir_P:  # 0D ocean Phosphorus
                class: ReactionReservoirScalar
                parameters:
                    # field_data: ScalarData        # change to IsotopeLinear to represent an isotope
                    # const: false                  # true to fix to constant value
                variable_links:
                    R*: P                           # rename to represent Phosphorus
                variable_attributes:
                    R:norm_value:           3.1e15  # mol 
                    R:initial_value:        3.1e15  # mol</code></pre><p><strong>See also</strong></p><p><a href="#PALEOboxes.Reservoirs.ReactionReservoir"><code>ReactionReservoir</code></a> (one value per cell for a spatially resolved Domain eg ocean), <a href="#PALEOboxes.Reservoirs.ReactionReservoirWellMixed"><code>ReactionReservoirWellMixed</code></a> (one value for a whole spatially resolved Domain).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/3a9919937bb4cb5572ad2871933be20db349f424/src/reactioncatalog/Reservoirs.jl#L8-L47">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.Reservoirs.ReactionReservoir" href="#PALEOboxes.Reservoirs.ReactionReservoir"><code>PALEOboxes.Reservoirs.ReactionReservoir</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">ReactionReservoir,  ReactionReservoirTotal</code></pre><p>A single (vector) reservoir (state variable) representing a biogeochemical tracer, ie one value per cell in a spatially-resolved Domain (eg ocean).</p><p>State Variables created depend on parameters:</p><ul><li><code>stateexplicit=true</code>: usual case to represent an ODE variable and time derivative, create state variable  <code>R</code> (mol m-3, with attribute <code>vfunction=VF_StateExplicit</code>) and <code>R_sms</code> (mol m-3 yr-1, with attribute <code>vfunction=VF_Deriv</code>).</li><li><code>stateexplicit=false</code>: for use with an ODE implicit state variable, create <code>R_sms</code> (with attribute <code>vfunction=VF_Deriv</code>) and a Dependency <code>R</code> (which  should be linked to a Variable with attribute <code>vfunction=VF_Total</code> calculated elsewhere, this Variable should also set the initial value). </li></ul><p>In addition:</p><ul><li>a Property <code>R_conc</code> (concentration in mol m-3) is always created.</li><li>if parameter <code>field_data &lt;: AbstractIsotopeScalar</code> (eg <code>IsotopeLinear</code>), a Property <code>R_delta</code> is created.</li><li><code>ReactionReservoirTotal</code> also calculates the Domain total <code>R_total</code> (units mol), eg to check budgets.</li></ul><p>Local name prefix <code>R</code> should then be renamed using <code>variable_links:</code> in the configuration file.</p><p><strong>Initialisation</strong></p><p>Initial value is set using <code>variable_attributes:</code> in the configuration file, using <code>R:initial_value</code> and <code>R:initial_delta</code> (NB: although <code>initial_value</code> is set on <code>R</code>, it <em>sets concentration in <code>mol m-3</code></em>.)</p><p>Transport is defined by attributes <code>:advect</code>, <code>:vertical_movement</code> (m d-1) set on the concentration variable <code>R_conc</code>. Optical extinction is defined by the <code>:specific_light_extinction</code> (m^2 mol-1) attribute set on the concentration variable <code>R_conc</code>.</p><p><strong>Example configuration in .yaml file</strong></p><pre><code class="nohighlight hljs">            reservoir_P:  # ocean Phosphorus
                class: ReactionReservoirTotal       # include _total (mol)
                parameters:
                    # field_data: ScalarData        # change to IsotopeLinear to represent an isotope                       
                variable_links:
                    R*: P                           # rename to represent Phosphorus
                variable_attributes:
                    R:norm_value:           3e-3    # mol m-3, normalisation value (used by some solvers)
                    R:initial_value:        2e-3    # mol m-3, initial concentration</code></pre><p><strong>See also</strong></p><p><a href="#PALEOboxes.Reservoirs.ReactionReservoirWellMixed"><code>ReactionReservoirWellMixed</code></a> (one value for the whole Domain), <a href="#PALEOboxes.Reservoirs.ReactionReservoirScalar"><code>ReactionReservoirScalar</code></a> (one value for a reservoir in a 0D Domain eg for COPSE <a href="../References/#Bergman2004">N. M. Bergman, Timothy M Lenton, Andrew J Watson (2004)</a>), <a href="#PALEOboxes.Reservoirs.ReactionReservoirConst"><code>ReactionReservoirConst</code></a> (constant time-independent value ie no state variable). </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/3a9919937bb4cb5572ad2871933be20db349f424/src/reactioncatalog/Reservoirs.jl#L126-L167">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.Reservoirs.ReactionReservoirWellMixed" href="#PALEOboxes.Reservoirs.ReactionReservoirWellMixed"><code>PALEOboxes.Reservoirs.ReactionReservoirWellMixed</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">ReactionReservoirWellMixed</code></pre><p>A Scalar Reservoir representing a well-mixed tracer in a vector Domain (eg ocean). Provides a scalar state Variable <code>R</code> and <code>R_sms</code>, and also vector Variables: <code>R_conc</code> (set to uniform concentration), and <code>R_vec_sms</code> Target for accumulating fluxes that is added to the scalar <code>R_sms</code>. </p><p><strong>Initialisation</strong></p><p>Initial value is set in the <code>variable_attributes:</code> section in the configuration file, using <code>R:initial_value</code> and <code>R:initial_delta</code>. NB: may be initialized either from mean concentration or total (set by parameter <code>initialization_type</code>)</p><p>TODO salinity normalisation.</p><p><strong>See also</strong></p><p><a href="#PALEOboxes.Reservoirs.ReactionReservoir"><code>ReactionReservoir</code></a> (one value per cell), <a href="#PALEOboxes.Reservoirs.ReactionReservoirScalar"><code>ReactionReservoirScalar</code></a> (one value for a reservoir in a 0D Domain eg for COPSE <a href="../References/#Bergman2004">N. M. Bergman, Timothy M Lenton, Andrew J Watson (2004)</a>). </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/3a9919937bb4cb5572ad2871933be20db349f424/src/reactioncatalog/Reservoirs.jl#L417-L433">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.Reservoirs.ReactionReservoirConst" href="#PALEOboxes.Reservoirs.ReactionReservoirConst"><code>PALEOboxes.Reservoirs.ReactionReservoirConst</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">ReactionReservoirConst</code></pre><p>A single (vector) constant tracer <code>R_conc</code> (constant replacement for a <a href="#PALEOboxes.Reservoirs.ReactionReservoir"><code>ReactionReservoir</code></a>).</p><p>Local name prefix <code>R</code> should then be renamed using <code>variable_links:</code> in the configuration file.</p><p><strong>Initialisation</strong></p><p>Set <code>:initial_value</code>, <code>:initial_delta</code> on <code>R_conc</code> (mol m-3) in the <code>variable_attributes:</code> section of the config file.</p><p>TODO salinity normalisation.</p><p><strong>Example configuration in .yaml file</strong></p><pre><code class="nohighlight hljs">            reservoir_B:  # Constant value for ocean Boron 
                class: ReactionReservoirConst
                parameters:
                    field_data: IsotopeLinear
                variable_links:
                    R*: B
                variable_attributes:                      
                    R_conc:initial_value:       0.4269239 # contemporary value
                    R_conc:initial_delta:       34.0</code></pre><p><strong>See also</strong></p><p><a href="#PALEOboxes.Reservoirs.ReactionReservoir"><code>ReactionReservoir</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/3a9919937bb4cb5572ad2871933be20db349f424/src/reactioncatalog/Reservoirs.jl#L276-L302">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.Reservoirs.ReactionReservoirForced" href="#PALEOboxes.Reservoirs.ReactionReservoirForced"><code>PALEOboxes.Reservoirs.ReactionReservoirForced</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">ReactionReservoirForced</code></pre><p>A single (vector) constant tracer (constant replacement for a <a href="#PALEOboxes.Reservoirs.ReactionReservoir"><code>ReactionReservoir</code></a>), with forcing.</p><p>Calculates <code>R_conc = R_conc_initial * R_FORCE</code>.</p><p>Local name prefix <code>R</code> should then be renamed using <code>variable_links:</code> in the configuration file.</p><p><strong>Initialisation</strong></p><p>NB: set <code>:initial_value</code>, <code>:initial_delta</code> on <code>R_conc_initial</code> in the <code>variable_attributes:</code> section of the config file.</p><p>TODO salinity normalisation.</p><p><strong>See also</strong></p><p><a href="#PALEOboxes.Reservoirs.ReactionReservoirConst"><code>ReactionReservoirConst</code></a>, <a href="#PALEOboxes.Reservoirs.ReactionReservoir"><code>ReactionReservoir</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/3a9919937bb4cb5572ad2871933be20db349f424/src/reactioncatalog/Reservoirs.jl#L342-L359">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.Reservoirs.ReactionConst" href="#PALEOboxes.Reservoirs.ReactionConst"><code>PALEOboxes.Reservoirs.ReactionConst</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">ReactionConst, ReactionScalarConst</code></pre><p>Create constant Property Variables with names from parameter <code>constnames</code>. </p><p><strong>Initialisation</strong></p><p>Constant values set by <code>:initial_value</code>, <code>:initial_delta</code> attributes in the <code>variable_attributes:</code> section of the configuration file.</p><p><strong>Example configuration in .yaml file</strong></p><pre><code class="nohighlight hljs">    atmfloor:
        reactions:                
            floorstubgasmr:  # Provide mixing-ratio boundary condition for a subset of atmospheric variables
                class: ReactionConst
                parameters:
                    constnames: [&quot;O2_mr&quot;, &quot;CH4_mr&quot;, &quot;CO2_mr&quot;, &quot;H2_mr&quot;] #, &quot;H2O_mr&quot;]  
                variable_attributes:        
                    O2_mr:initial_value:  [0.21]  # mol/mol
                    CH4_mr:initial_value:  [0.7443e-6] # [.NaN] # [1.271e-6] # [1.8e-6]  # mol/mol
                    CO2_mr:initial_value:  [300e-6]  # mol/mol
                    H2_mr:initial_value:   [.NaN]  # mol/mol</code></pre><p><strong>See also</strong></p><p><a href="#PALEOboxes.Reservoirs.ReactionReservoirConst"><code>ReactionReservoirConst</code></a>, <a href="#PALEOboxes.Reservoirs.ReactionReservoirScalar"><code>ReactionReservoirScalar</code></a>.  These provide additional variables (eg <code>R_delta</code>) to  allow them to function as a drop-in replacement for a non-constant Reservoir.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/3a9919937bb4cb5572ad2871933be20db349f424/src/reactioncatalog/Reservoirs.jl#L555-L579">source</a></section></article><h3 id="Linking-to-Reservoirs-from-a-Reaction"><a class="docs-heading-anchor" href="#Linking-to-Reservoirs-from-a-Reaction">Linking to Reservoirs from a Reaction</a><a id="Linking-to-Reservoirs-from-a-Reaction-1"></a><a class="docs-heading-anchor-permalink" href="#Linking-to-Reservoirs-from-a-Reaction" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.Reservoirs.ReservoirLinksVector" href="#PALEOboxes.Reservoirs.ReservoirLinksVector"><code>PALEOboxes.Reservoirs.ReservoirLinksVector</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">ReservoirLinksVector(reservoirlist) -&gt; (res::Vector, sms::Vector, diag::Vector)</code></pre><p>Convenience function to create variables required for a Reaction to link to a list of Reservoir variables. <code>res</code> contains VariableReactions <code>&lt;reservoir_name&gt;</code>, <code>sms</code> <code>&lt;reservoir_name&gt;_sms</code> that link to <code>State</code>, <code>State_sms</code> variables. <code>diag</code> contains VariableReactions <code>&lt;reservoir_name&gt;_norm</code> etc that link to additional properties.</p><p><strong>Arguments</strong></p><ul><li><code>reservoirlist::[(reservoir_name[::Isotope],       units,   description), ...]</code>: list of Reservoirs</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/3a9919937bb4cb5572ad2871933be20db349f424/src/reactioncatalog/Reservoirs.jl#L640-L649">source</a></section></article><h2 id="Variable-Statistics"><a class="docs-heading-anchor" href="#Variable-Statistics">Variable Statistics</a><a id="Variable-Statistics-1"></a><a class="docs-heading-anchor-permalink" href="#Variable-Statistics" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.VariableStats.ReactionSum" href="#PALEOboxes.VariableStats.ReactionSum"><code>PALEOboxes.VariableStats.ReactionSum</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">ReactionSum, ReactionVectorSum</code></pre><p>A sum of variables (eg budget).</p><ul><li>If Parameter <code>component_to_add == 0</code>, all components of Isotopes are included.</li><li>If Parameter <code>component_to_add == component_number</code>, a single component only is included.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/3a9919937bb4cb5572ad2871933be20db349f424/src/reactioncatalog/VariableStats.jl#L9-L15">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.VariableStats.ReactionWeightedMean" href="#PALEOboxes.VariableStats.ReactionWeightedMean"><code>PALEOboxes.VariableStats.ReactionWeightedMean</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">ReactionWeightedMean</code></pre><p>Weighted mean (eg by area or volume) of Variable</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/3a9919937bb4cb5572ad2871933be20db349f424/src/reactioncatalog/VariableStats.jl#L179-L183">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.VariableStats.ReactionAreaVolumeValInRange" href="#PALEOboxes.VariableStats.ReactionAreaVolumeValInRange"><code>PALEOboxes.VariableStats.ReactionAreaVolumeValInRange</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">ReactionAreaVolumeValInRange</code></pre><p>Fraction of Domain area or volume with Variable in a range of values.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/3a9919937bb4cb5572ad2871933be20db349f424/src/reactioncatalog/VariableStats.jl#L226-L230">source</a></section></article><h2 id="Fluxes"><a class="docs-heading-anchor" href="#Fluxes">Fluxes</a><a id="Fluxes-1"></a><a class="docs-heading-anchor-permalink" href="#Fluxes" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.Fluxes" href="#PALEOboxes.Fluxes"><code>PALEOboxes.Fluxes</code></a> — <span class="docstring-category">Module</span></header><section><div><pre><code class="language-julia hljs">Fluxes</code></pre><p>Create and manage collections of Target and Contrib Variables used to define fluxes within or between Domains.</p><p><strong>Conventions for defining biogeochemical fluxes within Domains</strong></p><ul><li>Particulate organic matter (including CaCO3) with stoichiometry Corg:N:P:Ccarb is usually transferred as: <code>flux_list</code> <code>[&quot;P&quot;, &quot;N&quot;, &quot;Corg::CIsotope&quot;, &quot;Ccarb::CIsotope&quot;]</code> with a prefix indicating the function (eg <code>export_</code>).</li><li>Solute fluxes are usually transferred as: <code>flux_list</code>  <code>[&quot;DIC::CIsotope&quot;, &quot;TAlk&quot;, &quot;Ca&quot;, &quot;P&quot;, &quot;O2&quot;, &quot;SO4::SIsotope&quot;, &quot;H2S::SIsotope&quot;, &quot;CH4::CIsotope&quot;]</code> (where these names match the Reservoir names for the solutes), with a prefix indicating the function (usually just <code>flux_</code> or <code>soluteflux_</code>).</li></ul><p><strong>Conventions for defining global fluxes between modules</strong></p><p>The model configuration <code>.yaml</code> file should create  a <code>Domain</code> for each global flux, containing one or more <a href="#PALEOboxes.Fluxes.ReactionFluxTarget"><code>Fluxes.ReactionFluxTarget</code></a>.  Fluxes are then transferred (copied) by adding a <a href="#PALEOboxes.Fluxes.ReactionFluxTransfer"><code>Fluxes.ReactionFluxTransfer</code></a> to each destination Domain.</p><p>Naming conventions for Earth system fluxes:</p><table><tr><th style="text-align: left">Domain name</th><th style="text-align: left">target prefix</th><th style="text-align: left">flux_list (illustrative, add as needed)</th></tr><tr><td style="text-align: left">fluxAtoLand</td><td style="text-align: left">flux_</td><td style="text-align: left">[&quot;CO2::CIsotope&quot;, &quot;O2&quot;]</td></tr><tr><td style="text-align: left">fluxRtoOcean</td><td style="text-align: left">flux_</td><td style="text-align: left">[&quot;DIC::CIsotope&quot;, &quot;TAlk&quot;, &quot;Ca&quot;, &quot;P&quot;, &quot;SO4::SIsotope&quot;]</td></tr><tr><td style="text-align: left">fluxOceanBurial</td><td style="text-align: left">flux_</td><td style="text-align: left">[&quot;Corg::CIsotope&quot;, &quot;Ccarb::CIsotope&quot;, &quot;Porg&quot;, &quot;Pauth&quot;, &quot;PFe&quot;, &quot;P&quot;, &quot;GYP::SIsotope&quot;, &quot;PYR::SIsotope&quot;]</td></tr><tr><td style="text-align: left">fluxSedCrusttoAOcean</td><td style="text-align: left">flux_</td><td style="text-align: left">[&quot;C::CIsotope&quot;, &quot;S::SIsotope&quot;, &quot;Redox&quot;]</td></tr><tr><td style="text-align: left">fluxLandtoSedCrust</td><td style="text-align: left">flux_</td><td style="text-align: left">[&quot;Ccarb::CIsotope&quot;, &quot;Corg::CIsotope&quot;, &quot;GYP::SIsotope&quot;, &quot;PYR::SIsotope&quot;]</td></tr><tr><td style="text-align: left">fluxOceanfloor</td><td style="text-align: left">particulateflux_</td><td style="text-align: left">[&quot;P&quot;, &quot;N&quot;, &quot;Corg::CIsotope&quot;, &quot;Ccarb::CIsotope&quot;]</td></tr><tr><td style="text-align: left"></td><td style="text-align: left">soluteflux_</td><td style="text-align: left">[&quot;DIC::CIsotope&quot;, &quot;TAlk&quot;, &quot;Ca&quot;, &quot;P&quot;, &quot;O2&quot;, &quot;SO4::SIsotope&quot;, &quot;H2S::SIsotope&quot;, &quot;CH4::CIsotope&quot;]</td></tr><tr><td style="text-align: left">fluxAtmtoOceansurface</td><td style="text-align: left">flux_</td><td style="text-align: left">[&quot;CO2::CIsotope&quot;, &quot;CH4::CIsotope&quot;, &quot;O2&quot;]</td></tr></table></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/3a9919937bb4cb5572ad2871933be20db349f424/src/reactioncatalog/Fluxes.jl#L1-L35">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.Fluxes.ReactionFluxTarget" href="#PALEOboxes.Fluxes.ReactionFluxTarget"><code>PALEOboxes.Fluxes.ReactionFluxTarget</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">ReactionFluxTarget</code></pre><p>Provides either a target for fluxes from <code>fluxlist</code> in an input <code>Domain</code> or a constant stub, optionally calculates totals.</p><p>For each <code>fluxname</code> in <code>fluxlist</code>, creates:</p><ul><li>if <code>const_stub==false</code>, an input <code>VarTarget</code> <code>pars.target_prefix.v*&quot;flux_&quot;*fluxname</code> (or if <code>const_stub==true</code>, a constant <code>VarProp</code>).</li><li>if <code>flux_totals</code> is <code>true</code>, a total <code>VarPropScalar</code> <code>target_prefix.v*&quot;flux_total_&quot;*fluxname</code>.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/3a9919937bb4cb5572ad2871933be20db349f424/src/reactioncatalog/Fluxes.jl#L141-L151">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.Fluxes.ReactionFluxTransfer" href="#PALEOboxes.Fluxes.ReactionFluxTransfer"><code>PALEOboxes.Fluxes.ReactionFluxTransfer</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">ReactionFluxTransfer</code></pre><p>Copy fluxes, optionally using transfer matrices to define cell-cell mappings if input and output fluxes  are in a different Domain.</p><p>A transfer is defined by Parameters:</p><ul><li><code>input_fluxes</code>: A list of input Variables generated by matches to string  <code>[inputdomain.][inputsubdomain.]prefix$fluxname$suffix</code> where <code>$fluxname$</code> matches any string. These have local names <code>input_$fluxname$</code>.</li><li><code>output_fluxes</code>: Corresponding list of output Variables. <code>[outputdomain.][outputsubdomain.]prefix$fluxname$suffix</code> where <code>$fluxname$</code> is generated from matches of <code>input_fluxes</code>. These have local names <code>output_$fluxname$</code> and are optional (ie ignored if not linked). Usually the output Domain is the Domain hosting the <code>ReactionFluxTransfer</code> (in general, it must be a Domain of the same size as the Domain hosting the <code>ReactionFluxTransfer</code>).</li><li><code>transfer_multiplier</code>: A scalar multiplier (usually 1.0).</li><li><code>transfer_matrix</code>: Form of transfer matrix.<ul><li>&#39;Identity&#39; copies fluxes directly assuming the output Domain has the same size as the input Domain.</li><li>&#39;Distribute&#39; uniformly distributes fluxes from input -&gt; output, including common cases n -&gt; 1 (input flux is summed to a scalar output), 1 -&gt; m (scalar input is distributed uniformly to m output cells).</li></ul></li></ul><p>There are three common cases:</p><ul><li>Transfer within a Domain, using <code>transfer_matrix</code> <code>Identity</code></li><li>Transfer from a <code>fluxXXX</code> Domain to the Domain hosting the <code>ReactionFluxTransfer</code>, using <code>transfer_matrix</code> to define a mapping if these Domains are of different sizes.  </li><li>Transfer from a <code>fluxXXX</code> Domain to the boundary cells of an interior Domain (eg <code>ocean.oceansurface</code>),  where the Domain hosting the <code>ReactionFluxTransfer</code> is the corresponding boundary Domain (eg <code>oceansurface</code>).</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/3a9919937bb4cb5572ad2871933be20db349f424/src/reactioncatalog/Fluxes.jl#L228-L255">source</a></section></article><h3 id="Contributing-to-flux-couplers-from-a-Reaction"><a class="docs-heading-anchor" href="#Contributing-to-flux-couplers-from-a-Reaction">Contributing to flux couplers from a Reaction</a><a id="Contributing-to-flux-couplers-from-a-Reaction-1"></a><a class="docs-heading-anchor-permalink" href="#Contributing-to-flux-couplers-from-a-Reaction" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.Fluxes.FluxContrib" href="#PALEOboxes.Fluxes.FluxContrib"><code>PALEOboxes.Fluxes.FluxContrib</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">FluxContrib(
    fluxprefix::AbstractString, flux_list;
    isotope_data::Dict,
    [, space=PB.CellSpace][, alloptional=true]
) -&gt; vartuple::NamedTuple</code></pre><p>Create a <code>NamedTuple</code> of <code>VarContrib</code> from <code>flux_prefix.*flux_list</code>, needed for a Reaction to write to a flux coupler. Entries in <code>flux_list</code> of form <code>fluxname::isotope</code> are parsed to look up isotope type from <code>isotope_data</code> Dict.</p><p>For each <code>fluxname</code> in <code>flux_list</code>, the generated <code>VarContrib</code> <code>vartuple.fluxname</code> have <code>link_namestr=$(fluxprefix)$(fluxname)&quot;</code> and  <code>localname=&quot;$(fluxprefix)$(fluxname)</code> (with any <code>.</code> in <code>fluxprefix</code> substituted to <code>_</code>).</p><p><strong>Example:</strong></p><pre><code class="language-julia hljs">julia&gt; fluxRtoOcean = PB.Fluxes.FluxContrib(&quot;fluxRtoOcean.flux_&quot;, [&quot;P&quot;, &quot;SO4::SIsotope&quot;], isotope_data=Dict(&quot;SIsotope&quot;=&gt;PB.IsotopeLinear), space=PB.ScalarSpace);

julia&gt; fluxRtoOcean.P
PALEOboxes.VariableReaction{PALEOboxes.VT_ReactContributor}
  localname=&#39;fluxRtoOcean_flux_P&#39;
  link_name=&#39;fluxRtoOcean.flux_P[unlinked]&#39;
  attributes=Dict{Symbol, Any}(:description =&gt; &quot;flux P&quot;, :space =&gt; PALEOboxes.ScalarSpace, :standard_variable =&gt; false, :norm_value =&gt; 1.0, :data_dims =&gt; String[], :long_name =&gt; &quot;&quot;, :vfunction =&gt; PALEOboxes.VF_Undefined, :field_data =&gt; PALEOboxes.ScalarData, :initial_delta =&gt; 0.0, :units =&gt; &quot;mol yr-1&quot;…)

julia&gt; fluxRtoOcean.SO4
PALEOboxes.VariableReaction{PALEOboxes.VT_ReactContributor}
  localname=&#39;fluxRtoOcean_flux_SO4&#39;
  link_name=&#39;fluxRtoOcean.flux_SO4[unlinked]&#39;
  attributes=Dict{Symbol, Any}(:description =&gt; &quot;flux SO4&quot;, :space =&gt; PALEOboxes.ScalarSpace, :standard_variable =&gt; false, :norm_value =&gt; 1.0, :data_dims =&gt; String[], :long_name =&gt; &quot;&quot;, :vfunction =&gt; PALEOboxes.VF_Undefined, :field_data =&gt; PALEOboxes.IsotopeLinear, :initial_delta =&gt; 0.0, :units =&gt; &quot;mol yr-1&quot;…)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/3a9919937bb4cb5572ad2871933be20db349f424/src/reactioncatalog/Fluxes.jl#L44-L74">source</a></section></article><h2 id="Forcings"><a class="docs-heading-anchor" href="#Forcings">Forcings</a><a id="Forcings-1"></a><a class="docs-heading-anchor-permalink" href="#Forcings" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.Forcings.ReactionForceInterp" href="#PALEOboxes.Forcings.ReactionForceInterp"><code>PALEOboxes.Forcings.ReactionForceInterp</code></a> — <span class="docstring-category">Type</span></header><section><div><p>ReactionForceInterp</p><p><code>F</code> forcing interpolated from parameters (use configuration file to rename output variable <code>F</code>) NB: no extrapolation ! (so eg set guard values at -1e30, 1e30)</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/3a9919937bb4cb5572ad2871933be20db349f424/src/reactioncatalog/Forcings.jl#L5-L10">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.GridForcings.ReactionForceGrid" href="#PALEOboxes.GridForcings.ReactionForceGrid"><code>PALEOboxes.GridForcings.ReactionForceGrid</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">ReactionForceGrid</code></pre><p>Apply time-dependent, periodic forcing from a variable in a netcdf or Matlab file, optionally applying a scaling, a constant linear offset, and a linear offset generated from a scalar model variable.</p><p>Reads records <code>tidx_start</code>:<code>tidx_end</code> (assumed to be the last dimension) for <code>data_var</code> from a gridded dataset in <code>netcdf_file</code> or <code>matlab_file</code>, maps grid to linear using the Domain grid (which must match that of <code>data_var</code>).</p><p>If <code>tidx_end &gt; tidx_start</code> (ie multiple records), reads a netcdf or Matlab variable named <code>time_var</code>, applies periodicity <code>cycle_time</code>, and uses this to linearly interpolate to model time.</p><p>Then applies forcing:</p><pre><code class="nohighlight hljs">F = scale*`data_var` + constant_offset + scale_offset_var*`scalar_offset_var`</code></pre><p>Optionally (if <code>interp_vars</code> is non-empty), interpolate forcing from additional dimensions in the netcdf file, given values supplied by additional Variable dependencies. NB: netcdf dimensions order must be grid<em>vars x interp</em>vars x time<em>var, where order within interp</em>vars also must match netcdf order.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/3a9919937bb4cb5572ad2871933be20db349f424/src/reactioncatalog/GridForcings.jl#L11-L29">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.FluxPerturb.ReactionFluxPerturb" href="#PALEOboxes.FluxPerturb.ReactionFluxPerturb"><code>PALEOboxes.FluxPerturb.ReactionFluxPerturb</code></a> — <span class="docstring-category">Type</span></header><section><div><p>ReactionFluxPerturb</p><p>Add scalar flux <code>F</code> interpolated from parameters (use configuration file to rename output variable <code>F</code>) NB: no extrapolation ! (so eg set guard values at -1e30, 1e30)</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/3a9919937bb4cb5572ad2871933be20db349f424/src/reactioncatalog/FluxPerturb.jl#L8-L13">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.FluxPerturb.ReactionRestore" href="#PALEOboxes.FluxPerturb.ReactionRestore"><code>PALEOboxes.FluxPerturb.ReactionRestore</code></a> — <span class="docstring-category">Type</span></header><section><div><p>ReactionRestore</p><p>Adds <code>RestoringFlux</code> in response to discrepancy between Variable <code>WatchLevel</code> and Parameter <code>RequiredLevel</code></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/3a9919937bb4cb5572ad2871933be20db349f424/src/reactioncatalog/FluxPerturb.jl#L100-L104">source</a></section></article><h2 id="Grids"><a class="docs-heading-anchor" href="#Grids">Grids</a><a id="Grids-1"></a><a class="docs-heading-anchor-permalink" href="#Grids" title="Permalink"></a></h2><p>Minimal generic model grids for test purposes.</p><p>These just define the Domain size, and don&#39;t provide coordinate or metric information (cell volume, area).  Models will usually require a Reaction with a Domain-specific implementation (eg for ocean, atmosphere) that defines coordinates and volumes etc and also implements transport (advection, eddy diffusion, etc).</p><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.GridReactions.ReactionUnstructuredVectorGrid" href="#PALEOboxes.GridReactions.ReactionUnstructuredVectorGrid"><code>PALEOboxes.GridReactions.ReactionUnstructuredVectorGrid</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">ReactionUnstructuredVectorGrid</code></pre><p>Create an <a href="@ref"><code>PB.UnstructuredVectorGrid</code></a> with <code>ncells</code> (from <code>ncells</code> Parameter).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/3a9919937bb4cb5572ad2871933be20db349f424/src/reactioncatalog/GridReactions.jl#L8-L12">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.GridReactions.ReactionCartesianGrid" href="#PALEOboxes.GridReactions.ReactionCartesianGrid"><code>PALEOboxes.GridReactions.ReactionCartesianGrid</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">ReactionCartesianGrid</code></pre><p>Create a <a href="@ref"><code>PB.CartesianArrayGrid</code></a> with <code>dims</code> and <code>dimnames</code>`</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/3a9919937bb4cb5572ad2871933be20db349f424/src/reactioncatalog/GridReactions.jl#L37-L41">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="PALEOboxes.GridReactions.ReactionGrid2DNetCDF" href="#PALEOboxes.GridReactions.ReactionGrid2DNetCDF"><code>PALEOboxes.GridReactions.ReactionGrid2DNetCDF</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">ReactionGrid2DNetCDF</code></pre><p>Create a 2D <a href="@ref"><code>PB.CartesianLinearGrid</code></a> from grid information in a NetCDF file.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/PALEOtoolkit/PALEOboxes.jl/blob/3a9919937bb4cb5572ad2871933be20db349f424/src/reactioncatalog/GridReactions.jl#L72-L76">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../Reaction API/">« Reaction API</a><a class="docs-footer-nextpage" href="../References/">References »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.15 on <span class="colophon-date" title="Sunday 17 April 2022 11:35">Sunday 17 April 2022</span>. Using Julia version 1.6.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
